(()=>{(function(){let{registerPlugin:ae}=wp.plugins,{PluginSidebar:re,PluginSidebarMoreMenuItem:oe}=wp.editor,{MediaUpload:se,MediaUploadCheck:ce}=wp.blockEditor,{PanelBody:L,TextControl:b,Button:y,Card:x,CardBody:E,ButtonGroup:ne,TextareaControl:I,CheckboxControl:z,SelectControl:R,Slot:X,Modal:K}=wp.components,{useSelect:H,useDispatch:O}=wp.data,{useState:B,useEffect:A}=wp.element,{__:e}=wp.i18n,J=i=>i.replace(/\.[^/.]+$/,"").replace(/-/g," "),de=({isOpen:i,onClose:r,onSave:d,initialVersion:v="",initialChangelog:a=""})=>{let[g,h]=B(v),[w,f]=B(a);A(()=>{i&&(h(v),f(a))},[i,v,a]);let c=()=>{if(!g.trim()){wp.data.dispatch("core/notices").createNotice("error",e("Version number is required.","digicommerce"),{type:"snackbar"});return}if(!/^\d+\.\d+\.\d+$/.test(g.trim())){wp.data.dispatch("core/notices").createNotice("error",e("Please use semantic versioning (e.g., 1.0.5)","digicommerce"),{type:"snackbar"});return}d({version:g.trim(),changelog:w.trim(),release_date:new Date().toISOString()}),r()};return i?React.createElement(K,{title:e(v?"Edit Version":"Add Version","digicommerce"),onRequestClose:r,className:"digi-version-modal"},React.createElement("div",{className:"digi-version-modal-content"},React.createElement(b,{label:e("Version Number","digicommerce"),value:g,onChange:h,placeholder:"1.0.0",__nextHasNoMarginBottom:!0}),React.createElement(I,{label:e("Changelog","digicommerce"),value:w,onChange:f,rows:4,__nextHasNoMarginBottom:!0}),React.createElement("div",{className:"digi-version-modal-footer"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:r},e("Cancel","digicommerce")),React.createElement(y,{variant:"primary",onClick:c},e("Save","digicommerce"))))):null},le=({versions:i,onDeleteVersion:r,onEditVersion:d})=>React.createElement("div",{className:"digi-version-list"},i.map((v,a)=>React.createElement(x,{key:a,className:"digi-version-item"},React.createElement("div",{className:"digi-version-list-header"},React.createElement("div",{className:"digi-version-list-title"},e("Version","digicommerce")," ",v.version,React.createElement("div",{className:"digi-version-actions"},React.createElement(y,{variant:"secondary",onClick:()=>d(a),className:"digi-edit-version"},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"12",height:"12"},React.createElement("path",{d:"M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"}))),React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>r(a),className:"digi-delete-version"},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"12",height:"12"},React.createElement("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"}))))))))),Y=({versions:i=[],onUpdateVersions:r})=>{let[d,v]=B(!1),[a,g]=B(null),h=u=>{if(a!==null){let l=[...i];l[a]=u,r(l),g(null)}else{let l=[...i,u];r(l)}},w=u=>{g(u),v(!0)},f=()=>{v(!1),g(null)},c=u=>{let l=i.filter((m,n)=>n!==u);r(l)};return React.createElement("div",{className:"digi-version-manager"},React.createElement("div",{className:"digi-version-header"},React.createElement("h3",null,e("Versions","digicommerce")),React.createElement(y,{variant:"secondary",onClick:()=>v(!0),className:"digi-add-version"},e("Add","digicommerce"))),React.createElement(le,{versions:i,onDeleteVersion:c,onEditVersion:w}),d&&React.createElement(de,{isOpen:d,onClose:f,onSave:h,initialVersion:a!==null?i[a].version:"",initialChangelog:a!==null?i[a].changelog:""}))},ee=({url:i})=>{let[r,d]=B(e("Click to copy","digicommerce")),[v,a]=B(!1),g=async()=>{try{await navigator.clipboard.writeText(i),d(e("Link copied","digicommerce")),setTimeout(()=>{d(e("Click to copy","digicommerce"))},2e3)}catch(h){console.error("Failed to copy:",h)}};return React.createElement("div",{className:"digi-url-field",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1)},React.createElement(b,{label:e("Direct Purchase URL","digicommerce"),value:i,onClick:g,style:{cursor:"pointer"},readOnly:!0,__nextHasNoMarginBottom:!0}),v&&React.createElement("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#1e1e1e",color:"white",padding:"6px 12px",borderRadius:"4px",fontSize:"12px",marginTop:"4px",zIndex:1e3,pointerEvents:"none",whiteSpace:"nowrap"}},r,React.createElement("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid #1e1e1e"}})))},me=({variation:i,index:r,onUpdate:d,onRemove:v,onDragStart:a,onDragOver:g,onDrop:h,onDragLeave:w,onDragEnd:f})=>{let c=async()=>{let o=document.createElement("input");o.type="file",o.multiple=!1,o.addEventListener("change",async P=>{let D=P.target.files[0];if(!D)return;let k=new FormData;k.append("action","digicommerce_upload_file"),k.append("file",D),k.append("upload_nonce",digicommerceVars.upload_nonce);try{digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("info",digicommerceVars.i18n.s3_uploading,{type:"snackbar",isDismissible:!1}):wp.data.dispatch("core/notices").createNotice("info",e("Uploading file...","digicommerce"),{type:"snackbar",isDismissible:!1});let S=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:k})).json();if(S.success){let U={name:S.data.name,file:S.data.file,id:S.data.id,type:S.data.type,size:S.data.size,itemName:J(S.data.name)},W=[...i.files||[],U];d(r,{...i,files:W}),digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("success",e("File successfully uploaded to Amazon S3","digicommerce"),{type:"snackbar"}):wp.data.dispatch("core/notices").createNotice("success",e("File uploaded successfully","digicommerce"),{type:"snackbar"})}else if(S.data?.s3_error)wp.data.dispatch("core/notices").createNotice("error",digicommerceVars.i18n.s3_upload_failed,{type:"snackbar"});else throw new Error(S.data||"Upload failed")}catch(C){console.error("Upload error:",C),wp.data.dispatch("core/notices").createNotice("error",e("Upload failed. Please try again.","digicommerce"),{type:"snackbar"})}}),o.click()},u=async o=>{let P=i.files[o],D=i.files.filter((k,C)=>C!==o);d(r,{...i,files:D});try{let k=await wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:P}});if(k.success){let C=k.message;k.status==="not_found"&&(C=e("File removed from variation (was already deleted from server)","digicommerce")),wp.data.dispatch("core/notices").createNotice("success",C,{type:"snackbar"})}}catch(k){console.error("Error deleting file:",k),d(r,{...i,files:[...i.files]}),wp.data.dispatch("core/notices").createNotice("error",k.message||e("Failed to delete file. Please try again.","digicommerce"),{type:"snackbar"})}},l=H(o=>o("core/editor").getCurrentPostId()),m=digicommerceVars.checkout_page_id||"",n=()=>m?`${wp.url.addQueryArgs(digicommerceVars.checkout_url,{})}`:"",_=wp.url.addQueryArgs(n(),{id:l,variation:r+1}),V=(o,P)=>{let D=[...i.files];D[o]={...D[o],versions:P},d(r,{...i,files:D})};return React.createElement(x,{className:"digi-variation-row digi-row",draggable:!0,onDragStart:o=>a(o,r),onDragOver:o=>g(o),onDrop:o=>h(o,r),onDragLeave:o=>w(o),onDragEnd:o=>f(o)},React.createElement(E,null,React.createElement("div",{className:"digi-inputs"},React.createElement(b,{label:e("Name","digicommerce"),value:i.name,onChange:o=>d(r,{...i,name:o}),placeholder:e("e.g., Single Site License","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Regular Price","digicommerce"),value:i.price,onChange:o=>{if(o===""){d(r,{...i,price:""});return}let P=parseFloat(o);isNaN(P)||(i.salePrice&&parseFloat(i.salePrice)>=P?d(r,{...i,price:P,salePrice:""}):d(r,{...i,price:P}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Sale Price","digicommerce"),value:i.salePrice||"",onChange:o=>{if(o===""){d(r,{...i,salePrice:""});return}let P=parseFloat(o);isNaN(P)||d(r,{...i,salePrice:P})},onBlur:o=>{let P=parseFloat(o.target.value),D=parseFloat(i.price);P&&D&&P>=D&&(wp.data.dispatch("core/notices").createNotice("error",e("Sale price must be less than regular price","digicommerce"),{type:"snackbar"}),d(r,{...i,salePrice:""}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(z,{label:e("Selected by default","digicommerce"),checked:i.isDefault||!1,onChange:o=>d(r,{...i,isDefault:o}),__nextHasNoMarginBottom:!0}),React.createElement(ee,{url:_})),React.createElement("div",{className:"digi-variation-files"},i.files&&i.files.length>0&&React.createElement("p",null,e("Download File:","digicommerce")),i.files&&i.files.map((o,P)=>React.createElement(x,{key:P,className:"digi-card"},React.createElement(E,{className:"digi-card-body"},React.createElement("div",{className:"digi-inputs"},React.createElement(b,{label:e("File Name","digicommerce"),value:o.name,onChange:D=>{let k=[...i.files];k[P]={...o,name:D},d(r,{...i,files:k})},__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("File Path","digicommerce"),value:o.file,disabled:!0,__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Item Name","digicommerce"),value:o.itemName||"",onChange:D=>{let k=[...i.files];k[P]={...o,itemName:D},d(r,{...i,files:k})},placeholder:e("Enter item name","digicommerce"),__nextHasNoMarginBottom:!0})),digicommerceVars.license_enabled&&React.createElement("div",{className:"digi-version-section"},React.createElement(Y,{versions:o.versions||[],onUpdateVersions:D=>V(P,D)})),React.createElement("div",{className:"digi-file-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>u(P)},e("Remove File","digicommerce")))))),React.createElement(y,{variant:"secondary",onClick:c,className:"digi-add-button"},e("Add Download File","digicommerce"))),React.createElement("div",{className:"digi-variation-slots"},React.createElement(X,{name:`DigiCommerceVariablePriceAfter-${r}`,fillProps:{variation:i,index:r,onUpdate:d}})),React.createElement("div",{className:"digi-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>v(r),className:"digi-remove-button"},e("Remove Variation","digicommerce")))))},ge=({file:i,index:r,onUpdate:d,onRemove:v,onDragStart:a,onDragOver:g,onDrop:h,onDragLeave:w,onDragEnd:f})=>{let c=u=>{d(r,{...i,versions:u})};return React.createElement(x,{className:"digi-file-row digi-row",draggable:!0,onDragStart:u=>a(u,r),onDragOver:u=>g(u),onDrop:u=>h(u,r),onDragLeave:u=>w(u),onDragEnd:u=>f(u)},React.createElement(E,null,React.createElement("div",{className:"digi-inputs"},React.createElement(b,{label:e("File Name","digicommerce"),value:i.name,onChange:u=>d(r,{...i,name:u}),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("File Path","digicommerce"),value:i.file,onChange:u=>d(r,{...i,file:u}),disabled:!0,__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Item Name","digicommerce"),value:i.itemName||"",onChange:u=>{let l={...i,itemName:u};d(r,l)},placeholder:e("Enter item name","digicommerce"),__nextHasNoMarginBottom:!0})),digicommerceVars.license_enabled&&React.createElement("div",{className:"digi-version-section"},React.createElement(Y,{versions:i.versions||[],onUpdateVersions:c})),React.createElement("div",{className:"digi-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>v(r)},e("Remove File","digicommerce")))))},ue=({feature:i,index:r,onUpdate:d,onRemove:v,onDragStart:a,onDragOver:g,onDrop:h,onDragLeave:w,onDragEnd:f})=>React.createElement(x,{className:"digi-feature-row digi-row",draggable:!0,onDragStart:c=>a(c,r),onDragOver:c=>g(c),onDrop:c=>h(c,r),onDragLeave:c=>w(c),onDragEnd:c=>f(c)},React.createElement(E,null,React.createElement("div",{className:"digi-inputs"},React.createElement(b,{label:e("Name","digicommerce"),value:i.name,onChange:c=>d(r,{...i,name:c}),placeholder:e("Name","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Text","digicommerce"),value:i.text,onChange:c=>d(r,{...i,text:c}),placeholder:e("Text","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>v(r),className:"digi-remove-button"},e("Remove Feature","digicommerce"))))),pe=()=>{let[i,r]=B([]),[d,v]=B([]),a=H(l=>l("core/editor").getCurrentPostId()),{editPost:g}=O("core/editor"),h=H(l=>l("core/editor").getEditedPostAttribute("meta"));A(()=>{wp.apiFetch({path:"/wp/v2/digi_product?per_page=-1",_fields:"id,title,meta"}).then(l=>{let m=l.filter(n=>n.meta?.digi_license_enabled===!0||n.meta?.digi_price_variations&&n.meta.digi_price_variations.some(_=>_.license_enabled));v(m)})},[]),A(()=>{h?.digi_upgrade_paths&&r(h.digi_upgrade_paths)},[h?.digi_upgrade_paths]);let w=()=>{let l={product_id:"",variation_id:"",prorate:!1,include_coupon:!1,discount_type:"fixed",discount_amount:""},m=[...i,l];r(m),g({meta:{digi_upgrade_paths:m}})},f=(l,m,n)=>{let _=[...i];_[l]={..._[l],[m]:n},r(_),g({meta:{digi_upgrade_paths:_}})},c=l=>{let m=i.filter((n,_)=>_!==l);r(m),g({meta:{digi_upgrade_paths:m}})};return!digicommerceVars.pro_active||!digicommerceVars.license_enabled||!(h?.digi_license_enabled||h?.digi_price_variations&&h.digi_price_variations.some(l=>l.license_enabled))?null:React.createElement(L,{title:e("Upgrade Paths","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},i.map((l,m)=>React.createElement(x,{key:m,className:"digi-upgrade-path-card"},React.createElement(E,{className:"digi-inputs"},React.createElement(R,{label:e("Target Product","digicommerce"),value:l.product_id,options:[{label:e("Select a product...","digicommerce"),value:""},...d.map(n=>({label:n.title.rendered,value:n.id.toString()}))],onChange:n=>f(m,"product_id",n),__nextHasNoMarginBottom:!0}),l.product_id&&d.find(n=>n.id===parseInt(l.product_id))?.meta?.digi_price_mode==="variations"&&React.createElement(R,{label:e("Target Variation","digicommerce"),value:l.variation_id,options:[{label:e("Select a variation...","digicommerce"),value:""},...d.find(n=>n.id===parseInt(l.product_id)).meta.digi_price_variations.filter(n=>n.license_enabled).map(n=>({label:n.name,value:n.id}))],onChange:n=>f(m,"variation_id",n),__nextHasNoMarginBottom:!0}),React.createElement(z,{label:e("Prorate","digicommerce"),checked:l.prorate,onChange:n=>f(m,"prorate",n),__nextHasNoMarginBottom:!0}),React.createElement(z,{label:e("Include Coupon","digicommerce"),checked:l.include_coupon,onChange:n=>f(m,"include_coupon",n),__nextHasNoMarginBottom:!0}),l.include_coupon&&React.createElement(React.Fragment,null,React.createElement(R,{label:e("Discount Type","digicommerce"),value:l.discount_type,options:[{label:e("Fixed Amount","digicommerce"),value:"fixed"},{label:e("Percentage","digicommerce"),value:"percentage"}],onChange:n=>f(m,"discount_type",n),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Amount","digicommerce"),type:"number",value:l.discount_amount,onChange:n=>f(m,"discount_amount",n),min:"0",step:l.discount_type==="percentage"?"1":"0.01",__nextHasNoMarginBottom:!0})),React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>c(m),className:"digi-remove-button"},e("Remove Path","digicommerce"))))),React.createElement(y,{variant:"primary",onClick:w,className:"digi-add-button"},e("Add Upgrade Path","digicommerce"))))},ve=({isOpen:i,onClose:r,initialData:d={},onSave:v})=>{let[a,g]=B({homepage:"",author:"",requires:"",requires_php:"",tested:"",description:"",installation:"",upgrade_notice:"",icons:{default:""},banners:{low:"",high:""},contributors:[],...d});A(()=>{i&&g({homepage:"",author:"",requires:"",requires_php:"",tested:"",description:"",installation:"",upgrade_notice:"",icons:{default:""},banners:{low:"",high:""},contributors:[],...d})},[i,d]);let h=()=>{g({...a,contributors:[...a.contributors,{username:"",avatar:"",name:""}]})},w=c=>{let u=[...a.contributors];u.splice(c,1),g({...a,contributors:u})},f=(c,u)=>{let l=[...a.contributors];l[c]=u,g({...a,contributors:l})};return i?React.createElement(K,{title:e("API Data","digicommerce"),onRequestClose:r,className:"digi-api-modal"},React.createElement("div",{className:"digi-api-modal-content"},React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Basic Information","digicommerce")),React.createElement(b,{label:e("Homepage","digicommerce"),type:"url",value:a.homepage,onChange:c=>g({...a,homepage:c}),help:e("Plugin homepage URL.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Author","digicommerce"),value:a.author,onChange:c=>g({...a,author:c}),help:e("Author information with optional link.","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Requirements","digicommerce")),React.createElement(b,{label:e("Requires WordPress Version","digicommerce"),value:a.requires,onChange:c=>g({...a,requires:c}),help:e("Minimum required WordPress version.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Requires PHP Version","digicommerce"),value:a.requires_php,onChange:c=>g({...a,requires_php:c}),help:e("Minimum required PHP version.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Tested up to","digicommerce"),value:a.tested,onChange:c=>g({...a,tested:c}),help:e("WordPress version the plugin has been tested up to.","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Description & Installation","digicommerce")),React.createElement(I,{label:e("Description","digicommerce"),value:a.description,onChange:c=>g({...a,description:c}),help:e("Full description of the plugin (HTML allowed).","digicommerce"),rows:4,__nextHasNoMarginBottom:!0}),React.createElement(I,{label:e("Installation","digicommerce"),value:a.installation,onChange:c=>g({...a,installation:c}),help:e("Installation instructions (HTML allowed).","digicommerce"),rows:4,__nextHasNoMarginBottom:!0}),React.createElement(I,{label:e("Upgrade Notice","digicommerce"),value:a.upgrade_notice,onChange:c=>g({...a,upgrade_notice:c}),help:e("Upgrade notices for your users.","digicommerce"),rows:2,__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Assets","digicommerce")),React.createElement(b,{label:e("Plugin Icon URL","digicommerce"),type:"url",value:a.icons.default,onChange:c=>g({...a,icons:{default:c}}),help:e("URL to your plugin's icon (256x256px).","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Banner Low Resolution URL","digicommerce"),type:"url",value:a.banners.low,onChange:c=>g({...a,banners:{...a.banners,low:c}}),help:e("URL to your plugin's low resolution banner (772x250px).","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Banner High Resolution URL","digicommerce"),type:"url",value:a.banners.high,onChange:c=>g({...a,banners:{...a.banners,high:c}}),help:e("URL to your plugin's high resolution banner (1544x500px).","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Contributors","digicommerce")),React.createElement("div",{className:"digi-contributor-wrap"},a.contributors.map((c,u)=>React.createElement("div",{key:u,className:"digi-contributor-row"},React.createElement("div",{className:"digi-contributor-fields"},React.createElement(b,{value:c.username||"",onChange:l=>f(u,{...c,username:l}),placeholder:e("WordPress.org username","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{value:c.name||"",onChange:l=>f(u,{...c,name:l}),placeholder:e("Display Name","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(b,{value:c.avatar||"",onChange:l=>f(u,{...c,avatar:l}),type:"url",placeholder:e("Avatar URL","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement(y,{isDestructive:!0,variant:"secondary",onClick:()=>w(u),icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"},React.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}))}))),React.createElement(y,{variant:"secondary",onClick:()=>h(),className:"digi-add-contributor"},e("Add Contributor","digicommerce")))),React.createElement("div",{className:"digi-api-modal-footer"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:r},e("Cancel","digicommerce")),React.createElement(y,{variant:"primary",onClick:()=>v(a)},e("Save","digicommerce"))))):null},he=()=>{let[i,r]=B(!1),{editPost:d}=O("core/editor"),v=H(a=>a("core/editor").getEditedPostAttribute("meta"));return!digicommerceVars.pro_active||!digicommerceVars.license_enabled?null:React.createElement(L,{title:e("API Data","digicommerce"),initialOpen:!1},!v?.digi_api_data||Object.keys(v.digi_api_data).length===0?React.createElement(y,{variant:"primary",onClick:()=>r(!0),className:"digi-add-button"},e("Add API Data","digicommerce")):React.createElement("div",{className:"digi-api-data-preview"},React.createElement(y,{variant:"primary",onClick:()=>r(!0)},e("Edit API Data","digicommerce")),React.createElement("div",{className:"digi-api-data-info"},React.createElement("span",null,React.createElement("strong",null,e("Requires:","digicommerce"))," WordPress ",v.digi_api_data.requires),React.createElement("span",null,React.createElement("strong",null,e("Tested up to:","digicommerce"))," ",v.digi_api_data.tested))),i&&React.createElement(ve,{isOpen:i,onClose:()=>r(!1),initialData:v?.digi_api_data,onSave:a=>{d({meta:{digi_api_data:a}}),r(!1)}}))},_e=()=>{let[i,r]=B([]),[d,v]=B([]),[a,g]=B([]),{editPost:h}=O("core/editor"),w=H(m=>m("core/editor").getEditedPostAttribute("meta")),f=H(m=>m("core/editor").getCurrentPostId());A(()=>{wp.apiFetch({path:"/wp/v2/digi_product?per_page=-1&status=publish",_fields:"id,title,meta"}).then(m=>{let n=m.filter(_=>_.id!==f);v(n)}).catch(m=>{console.error("Error fetching products:",m)})},[f]),A(()=>{w?.digi_bundle_products&&r(w.digi_bundle_products)},[w?.digi_bundle_products]),A(()=>{if(i.length>0&&d.length>0){let m=i.filter(n=>n&&n!=="").map(n=>{let _=d.find(V=>V.id===parseInt(n));if(_){let V=_.meta?.digi_files||[],o=Array.isArray(V)?V.length:0;return{id:_.id,name:_.title.rendered,fileCount:o}}return null}).filter(Boolean);g(m)}else g([])},[i,d]);let c=()=>{let m=[...i,""];r(m),h({meta:{digi_bundle_products:m}})},u=(m,n)=>{let _=[...i];_[m]=n,r(_),h({meta:{digi_bundle_products:_}})},l=m=>{let n=i.filter((_,V)=>V!==m);r(n),h({meta:{digi_bundle_products:n}})};return React.createElement(L,{title:e("Bundle Products","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},React.createElement("div",{className:"digi-bundle-info"},React.createElement("p",null,e("Select products to include in this bundle. Customer will receive downloads for all selected products with a single master license.","digicommerce"))),i.map((m,n)=>React.createElement(x,{key:n,className:"digi-bundle-product-card"},React.createElement(E,{className:"digi-inputs"},React.createElement(R,{label:e("Product","digicommerce"),value:m,options:[{label:e("Select a product...","digicommerce"),value:""},...d.map(_=>({label:_.title.rendered,value:_.id.toString()}))],onChange:_=>u(n,_),__nextHasNoMarginBottom:!0}),React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>l(n),className:"digi-remove-button"},e("Remove Product","digicommerce"))))),React.createElement(y,{variant:"primary",onClick:c,className:"digi-add-button"},e("Add Product","digicommerce")),a.length>0&&React.createElement(x,{className:"digi-bundle-preview",style:{marginTop:"20px",backgroundColor:"#f8f9fa"}},React.createElement(E,null,React.createElement("h4",{style:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"600"}},e("Bundle Preview","digicommerce")),React.createElement("div",{style:{fontSize:"13px",color:"#666"}},React.createElement("p",{style:{margin:"0 0 8px 0"}},sprintf(e("This bundle includes %d products:","digicommerce"),a.length)),React.createElement("ul",{style:{margin:"0"}},a.map(m=>React.createElement("li",{key:m.id,style:{marginBottom:"4px"}},React.createElement("strong",null,m.name),m.fileCount>0&&React.createElement("span",{style:{color:"#888",fontSize:"12px"}}," ","(",sprintf(e("%d files","digicommerce"),m.fileCount),")")))),React.createElement("p",{style:{margin:"8px 0 0 0",fontSize:"12px",fontStyle:"italic"}},e("Customers will get one master license that works for all bundled products.","digicommerce")))))))};ae("digi-product-sidebar",{render:()=>{let[i,r]=B(0),[d,v]=B(""),[a,g]=B([]),[h,w]=B([]),[f,c]=B("single"),[u,l]=B(""),[m,n]=B([]),[_,V]=B(""),{editPost:o}=O("core/editor"),P=H(t=>t("core/editor").getCurrentPostId()),D=digicommerceVars.checkout_page_id||"",k=()=>D?`${wp.url.addQueryArgs(digicommerceVars.checkout_url,{})}`:"",C=H(t=>t("core/editor").getEditedPostAttribute("meta"));A(()=>{C&&(r(C.digi_price||0),v(C.digi_sale_price||""),g(C.digi_files||[]),w(C.digi_price_variations||[]),c(C.digi_price_mode||"single"),l(C.digi_product_description||""),n(C.digi_features||[]),V(C.digi_instructions||""))},[C]);let S=()=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.addEventListener("change",async s=>{let p=s.target.files[0];if(!p)return;let N=new FormData;N.append("action","digicommerce_upload_file"),N.append("file",p),N.append("upload_nonce",digicommerceVars.upload_nonce);try{digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("info",digicommerceVars.i18n.s3_uploading,{type:"snackbar",isDismissible:!1}):wp.data.dispatch("core/notices").createNotice("info",e("Uploading file...","digicommerce"),{type:"snackbar",isDismissible:!1});let F=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:N})).json();if(F.success){let T={name:F.data.name,file:F.data.file,id:F.data.id,type:F.data.type,size:F.data.size,itemName:J(F.data.name)},q=[...a,T];g(q),o({meta:{digi_files:q}}),digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("success",e("File successfully uploaded to Amazon S3","digicommerce"),{type:"snackbar"}):wp.data.dispatch("core/notices").createNotice("success",e("File uploaded successfully","digicommerce"),{type:"snackbar"})}else if(F.data?.s3_error)wp.data.dispatch("core/notices").createNotice("error",digicommerceVars.i18n.s3_upload_failed,{type:"snackbar"});else throw new Error(F.data||"Upload failed")}catch(M){console.error("Upload error:",M),wp.data.dispatch("core/notices").createNotice("error",e("Upload failed. Please try again.","digicommerce"),{type:"snackbar"})}}),t.click()},U=(t,s)=>{let p=[...a];p[t]=s,g(p),o({meta:{digi_files:p}})},W=t=>{let s=a[t],p=a.filter((N,M)=>M!==t);g(p),o({meta:{digi_files:p}}),wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:s,is_s3:s.s3||!1}}).then(N=>{if(N.success){let M=N.message;N.status==="not_found"&&(M=digicommerceVars.s3_enabled?e("File removed from product (was already deleted from S3)","digicommerce"):e("File removed from product (was already deleted from server)","digicommerce")),wp.data.dispatch("core/notices").createNotice("success",M,{type:"snackbar"})}}).catch(N=>{console.error("Error deleting file:",N),g([...a]),o({meta:{digi_files:[...a]}}),wp.data.dispatch("core/notices").createNotice("error",N.message||e("Failed to delete file. Please try again.","digicommerce"),{type:"snackbar"})})},ie=t=>{c(t),o({meta:{digi_price_mode:t}})},fe=()=>{let s={id:Date.now().toString()+Math.random().toString(36).substr(2,5),name:"",price:0,salePrice:null,files:[],subscription_enabled:!1,subscription_period:"month",subscription_free_trial:{duration:0,period:"days"},subscription_signup_fee:0},p=[...h,s];w(p),o({meta:{digi_price_variations:p}})},be=(t,s)=>{let p=[...h];p[t]=s,w(p),o({meta:{digi_price_variations:p}})},ye=async t=>{let s=h[t];if(s.files&&s.files.length>0)for(let N of s.files)try{await wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:N,is_s3:N.s3||!1}})}catch(M){console.error("Error deleting variation file:",M),wp.data.dispatch("core/notices").createNotice("error",e("Error deleting some files, but variation was removed","digicommerce"),{type:"snackbar"})}let p=h.filter((N,M)=>M!==t);w(p),o({meta:{digi_price_variations:p}}),wp.data.dispatch("core/notices").createNotice("success",digicommerceVars.s3_enabled?e("Variation and associated S3 files removed successfully","digicommerce"):e("Variation removed successfully","digicommerce"),{type:"snackbar"})},Ne=()=>{let t={name:"",text:""},s=[...m,t];n(s),o({meta:{digi_features:s}})},we=(t,s)=>{let p=[...m];p[t]=s,n(p),o({meta:{digi_features:p}})},Pe=t=>{let s=m.filter((p,N)=>N!==t);n(s),o({meta:{digi_features:s}})},G=(t,s)=>{t.dataTransfer.setData("text/plain",s),t.currentTarget.classList.add("is-dragging")},j=t=>{t.preventDefault(),t.currentTarget.classList.add("is-drag-over")},$=t=>{t.currentTarget.classList.remove("is-drag-over"),t.currentTarget.classList.remove("is-dragging")},Q=t=>{t.currentTarget.classList.remove("is-dragging"),t.currentTarget.classList.remove("is-drag-over"),document.querySelectorAll(".digi-file-row, .digi-variation-row, .digi-feature-row").forEach(s=>{s.classList.remove("is-drag-over"),s.classList.remove("is-dragging")})},Z=(t,s,p,N,M)=>{t.preventDefault(),t.currentTarget.classList.remove("is-drag-over"),t.currentTarget.classList.remove("is-dragging");let F=parseInt(t.dataTransfer.getData("text/plain"));if(F===s)return;let T=[...p],[q]=T.splice(F,1);T.splice(s,0,q),N(T),o({meta:{[M]:T}}),document.querySelectorAll(".digi-file-row, .digi-variation-row, .digi-feature-row").forEach(te=>{te.classList.remove("is-drag-over"),te.classList.remove("is-dragging")})},Ce=(t,s)=>Z(t,s,a,g,"digi_files"),Be=(t,s)=>Z(t,s,h,w,"digi_price_variations"),ke=(t,s)=>Z(t,s,m,n,"digi_features");return React.createElement(React.Fragment,null,React.createElement(oe,{target:"product-details"},e("Product Details","digicommerce")),React.createElement(re,{name:"product-details",title:e("Product Details","digicommerce"),className:"digi-product-sidebar"},React.createElement(L,{title:e("Pricing","digicommerce"),initialOpen:!0},React.createElement("div",{className:"digi-price-mode-toggle"},React.createElement(ne,{className:"digi-price-mode-buttons"},React.createElement(y,{variant:f==="single"?"primary":"secondary",onClick:()=>ie("single"),className:"digi-price-mode-button"},e("Single Price","digicommerce")),React.createElement(y,{variant:f==="variations"?"primary":"secondary",onClick:()=>ie("variations"),className:"digi-price-mode-button"},e("Price Variations","digicommerce")))),f==="single"?React.createElement("div",{className:"digi-inputs"},React.createElement(b,{label:e("Regular Price","digicommerce"),value:i,onChange:t=>{if(t===""){r("");return}let s=parseFloat(t);isNaN(s)||(r(s),o({meta:{digi_price:s}}),d&&parseFloat(d)>=s&&(v(""),o({meta:{digi_sale_price:""}})))},onBlur:()=>{let t=parseFloat(i)||0;r(t),o({meta:{digi_price:t}})},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(b,{label:e("Sale Price","digicommerce"),value:d,onChange:t=>{if(t===""){v(""),o({meta:{digi_sale_price:""}});return}let s=parseFloat(t);isNaN(s)||(v(s),o({meta:{digi_sale_price:s}}))},onBlur:t=>{let s=parseFloat(t.target.value),p=parseFloat(i);s&&p&&s>=p&&(wp.data.dispatch("core/notices").createNotice("error",e("Sale price must be less than regular price","digicommerce"),{type:"snackbar"}),v(""),o({meta:{digi_sale_price:""}}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(ee,{url:wp.url.addQueryArgs(k(),{id:P})}),React.createElement("div",{className:"digi-slot-container"},React.createElement(X,{name:"DigiCommerceSinglePriceAfter"}))):React.createElement("div",{className:"digi-variations-section"},React.createElement("div",{className:"digi-container"},h.map((t,s)=>React.createElement(me,{key:s,variation:t,index:s,onUpdate:be,onRemove:ye,onDragStart:G,onDragOver:j,onDrop:Be,onDragLeave:$,onDragEnd:Q}))),React.createElement(y,{variant:"primary",onClick:fe,className:"digi-add-button"},e("Add Price Variation","digicommerce")))),React.createElement(L,{title:e("Downloadable Files","digicommerce"),initialOpen:!1},a.length>0&&React.createElement("div",{style:{display:"flex",backgroundColor:"#f6f7f9",borderRadius:"0.75rem",fontSize:"0.7rem",marginBottom:"1.5rem",padding:"1rem",alignItems:"center"}},digicommerceVars.s3_enabled?e("NOTE: When a file is removed, it is completely removed from your S3 bucket.","digicommerce"):e("NOTE: When a file is removed, it is completely removed from your server.","digicommerce")),React.createElement("div",{className:"digi-container"},a.map((t,s)=>React.createElement(ge,{key:s,file:t,index:s,onUpdate:U,onRemove:W,onDragStart:G,onDragOver:j,onDrop:Ce,onDragLeave:$,onDragEnd:Q}))),React.createElement(y,{variant:"primary",onClick:S,className:"digi-add-button"},e("Add New File","digicommerce"))),React.createElement(L,{title:e("Description","digicommerce"),initialOpen:!1},React.createElement(I,{help:e("Add a detailed description for your product.","digicommerce"),value:u,onChange:t=>{l(t),o({meta:{digi_product_description:t}})},rows:4,__nextHasNoMarginBottom:!0})),React.createElement(L,{title:e("Gallery","digicommerce"),initialOpen:!1},React.createElement(ce,null,React.createElement(se,{onSelect:t=>{let s=t.map(p=>({id:p.id,url:p.sizes?.medium?.url||p.url,alt:p.alt||""}));o({meta:{digi_gallery:s}})},allowedTypes:["image"],multiple:!0,gallery:!0,value:C?.digi_gallery?.map(t=>t.id)||[],render:({open:t})=>React.createElement("div",null,React.createElement("div",{className:"digi-gallery-grid"},(C?.digi_gallery||[]).map((s,p)=>React.createElement("div",{key:p,className:"digi-gallery-item",onClick:t,role:"button",tabIndex:0,onKeyDown:N=>{(N.key==="Enter"||N.key===" ")&&t()}},React.createElement("img",{src:s.url,alt:s.alt,className:"digi-gallery-image"}),React.createElement("button",{type:"button",onClick:N=>{N.stopPropagation();let M=[...C.digi_gallery||[]];M.splice(p,1),o({meta:{digi_gallery:M}})},className:"digi-remove-gallery-image"},React.createElement("span",{className:"sr-only"},e("Remove image","digicommerce")),React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2"},React.createElement("path",{d:"M18 6L6 18M6 6l12 12"})))))),React.createElement(y,{variant:"primary",onClick:t,className:"digi-add-button"},C?.digi_gallery?.length?e("Edit Gallery","digicommerce"):e("Add Gallery Images","digicommerce")))}))),React.createElement(L,{title:e("Features","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},m.map((t,s)=>React.createElement(ue,{key:s,feature:t,index:s,onUpdate:we,onRemove:Pe,onDragStart:G,onDragOver:j,onDrop:ke,onDragLeave:$,onDragEnd:Q}))),React.createElement(y,{variant:"primary",onClick:Ne,className:"digi-add-button"},e("Add Feature","digicommerce"))),React.createElement(L,{title:e("Download Instructions","digicommerce"),initialOpen:!1},React.createElement(I,{label:e("Instructions for customers","digicommerce"),help:e("These instructions will be shown to customers after purchase","digicommerce"),value:_,onChange:t=>{V(t),o({meta:{digi_instructions:t}})},rows:4,__nextHasNoMarginBottom:!0})),React.createElement(pe,null),React.createElement(he,null),React.createElement(_e,null)))},icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"24",height:"24",fill:"currentColor",className:"digi__icon"},React.createElement("circle",{cx:"256",cy:"256",r:"256"}),React.createElement("path",{d:"M361.4858,348.7728c4.6805,0,8.9099,1.8997,11.9904,4.96,3.1729,3.177,4.952,7.4854,4.9451,11.9755,0,4.672-1.8912,8.9099-4.9451,11.9701-3.1801,3.1788-7.494,4.9621-11.9904,4.9568-4.4924.0071-8.8023-1.7768-11.9755-4.9568-3.1781-3.1723-4.9618-7.4797-4.9568-11.9701,0-4.6805,1.8965-8.9099,4.9568-11.9755,3.1739-3.1794,7.483-4.9641,11.9755-4.96h0ZM199.2159,348.7728c4.6795,0,8.9152,1.8997,11.9755,4.96,3.1815,3.1724,4.9663,7.4826,4.9589,11.9755,0,4.672-1.8933,8.9099-4.9589,11.9701-3.1722,3.1815-7.4827,4.9657-11.9755,4.9568-4.491.0081-8.7996-1.7761-11.9701-4.9568-3.1808-3.1707-4.9656-7.479-4.9589-11.9701,0-4.6805,1.8933-8.9099,4.9589-11.9755,3.1712-3.1801,7.4791-4.9652,11.9701-4.96h0ZM145.0057,129.3637l8.0203,33.6693h-43.2928c-3.9738,0-7.1952,3.2214-7.1952,7.1952s3.2214,7.1952,7.1952,7.1952h100.7712c3.9729,0,7.1936,3.2207,7.1936,7.1936s-3.2207,7.1936-7.1936,7.1936h-50.6219l2.4341,10.2304h-9.0208c-3.9738,0-7.1952,3.2214-7.1952,7.1952s3.2214,7.1952,7.1952,7.1952h64.6784c3.9738.0484,7.1559,3.3091,7.1075,7.2829-.0476,3.9055-3.202,7.0599-7.1075,7.1075h-48.8075l2.528,10.6197h-57.4848c-3.9712,0-7.1904,3.2203-7.1904,7.1936s3.2203,7.1936,7.1904,7.1936h113.7248c3.9738.0481,7.1562,3.3084,7.1082,7.2822-.0472,3.906-3.2022,7.0609-7.1082,7.1082h-49.3802l2.6699,11.2192c-6.3669.7413-12.0949,3.6533-16.4149,7.9669-5.0325,5.0379-8.1557,11.9872-8.1557,19.6373s3.1243,14.6027,8.1557,19.6352c5.0379,5.0411,11.9872,8.1621,19.6437,8.1621h2.5835c-3.7221,1.5774-7.1056,3.8568-9.9659,6.7136-5.8861,5.8685-9.1892,13.8418-9.1776,22.1536,0,8.6475,3.5051,16.4757,9.1776,22.1451,5.6693,5.6693,13.5029,9.1744,22.1451,9.1744,8.6475,0,16.4843-3.5051,22.1536-9.1744,5.6693-5.6693,9.1744-13.4976,9.1744-22.1451.0113-8.3111-3.2904-16.2839-9.1744-22.1536-2.8615-2.8568-6.2461-5.1361-9.9691-6.7136h137.8997c-3.7203,1.5773-7.1018,3.8567-9.9595,6.7136-5.6693,5.6693-9.1776,13.5029-9.1776,22.1536s3.5083,16.4757,9.1776,22.1451c5.6693,5.6693,13.4965,9.1744,22.1451,9.1744s16.4693-3.5051,22.1419-9.1744c5.6725-5.6693,9.1915-13.4976,9.1915-22.1451s-3.52-16.4843-9.1915-22.1536c-2.8512-2.8593-6.2294-5.1392-9.9477-6.7136h10.2677c3.9563,0,7.1851-3.2203,7.1851-7.1968s-3.2288-7.1968-7.1851-7.1968h-199.4944c-3.68,0-7.0304-1.5093-9.4688-3.9381-2.4288-2.4352-3.9445-5.7803-3.9445-9.4656,0-3.68,1.5157-7.0251,3.9445-9.4592,2.4373-2.4288,5.7888-3.9445,9.4688-3.9445h175.072c5.8261,0,11.2224-1.9488,15.5211-5.3291,4.2763-3.3653,7.4464-8.1472,8.8427-13.8368l25.3365-103.9563c.2353-.739.353-1.5104.3488-2.2859,0-3.9733-3.2-7.1968-7.1851-7.1968h-234.5749l-10.0736-42.2912c-.6792-3.3563-3.6295-5.7691-7.0539-5.7685h-30.1205c-3.9735-.0012-7.1956,3.219-7.1968,7.1925v.0043c0,3.9729,3.2207,7.1936,7.1936,7.1936h24.4427v-.0011Z",fill:"#fff"}))})})();})();
