(()=>{(function(){let{registerPlugin:ee}=wp.plugins,{PluginSidebar:ie,PluginSidebarMoreMenuItem:te}=wp.editor,{MediaUpload:ae,MediaUploadCheck:re}=wp.blockEditor,{PanelBody:k,TextControl:y,Button:N,Card:V,CardBody:H,ButtonGroup:oe,TextareaControl:A,CheckboxControl:O,SelectControl:T,Slot:Q,Modal:Z}=wp.components,{useSelect:S,useDispatch:E}=wp.data,{useState:P,useEffect:x}=wp.element,{__:e}=wp.i18n,se=i=>i.replace(/\.[^/.]+$/,"").replace(/-/g," "),ke=i=>{if(i===0)return"0 Bytes";let o=1024,l=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(i)/Math.log(o));return parseFloat((i/Math.pow(o,v)).toFixed(2))+" "+l[v]},I=(()=>{let i=async v=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.addEventListener("change",async s=>{let m=s.target.files[0];if(!m)return;let f=100*1024*1024;if(m.size>f){wp.data.dispatch("core/notices").createNotice("error",e("File size too large. Maximum size is 100MB.","digicommerce"),{type:"snackbar"});return}let h=["pdf","doc","docx","xls","xlsx","txt","zip","rar","7z","jpg","jpeg","png","gif","svg","mp4","mp3","wav"],a=m.name.split(".").pop().toLowerCase();if(!h.includes(a)){wp.data.dispatch("core/notices").createNotice("error",e("Invalid file type. Please upload a supported file format.","digicommerce"),{type:"snackbar"});return}try{let g=await o(m);g&&v&&v(g)}catch(g){console.error("Upload failed:",g)}}),t.click()},o=async v=>{let t=new FormData;t.append("action","digicommerce_upload_file"),t.append("file",v),t.append("upload_nonce",digicommerceVars.upload_nonce);let s="upload_"+Date.now();try{let m=digicommerceVars.s3_enabled?digicommerceVars.i18n.s3_uploading:e("Uploading file...","digicommerce");wp.data.dispatch("core/notices").createNotice("info",m,{type:"snackbar",isDismissible:!1,id:s});let f=setTimeout(()=>{wp.data.dispatch("core/notices").removeNotice(s),wp.data.dispatch("core/notices").createNotice("warning",e("Upload is taking longer than expected. Please wait...","digicommerce"),{type:"snackbar",id:s+"_timeout"})},3e4),h=await fetch(digicommerceVars.ajaxurl,{method:"POST",body:t});if(clearTimeout(f),wp.data.dispatch("core/notices").removeNotice(s),wp.data.dispatch("core/notices").removeNotice(s+"_timeout"),!h.ok)throw new Error(`HTTP error! status: ${h.status}`);let a=await h.json();if(a.success){let g={name:a.data.name,file:a.data.file,id:a.data.id,type:a.data.type,size:a.data.size,itemName:se(a.data.name),s3:a.data.s3||!1},p=digicommerceVars.s3_enabled?e("File successfully uploaded to Amazon S3","digicommerce"):e("File uploaded successfully","digicommerce");return wp.data.dispatch("core/notices").createNotice("success",p,{type:"snackbar"}),g}else{let g=a.data||e("Upload failed. Please try again.","digicommerce");throw a.data&&a.data.includes("S3")?g=digicommerceVars.i18n.s3_upload_failed:a.data&&a.data.includes("timeout")?g=e("Upload timed out. Please try again with a smaller file.","digicommerce"):a.data&&a.data.includes("size")&&(g=e("File too large. Please choose a smaller file.","digicommerce")),new Error(g)}}catch(m){wp.data.dispatch("core/notices").removeNotice(s),wp.data.dispatch("core/notices").removeNotice(s+"_timeout"),console.error("Upload error:",m);let f=m.message;throw m.message.includes("NetworkError")||m.message.includes("Failed to fetch")?f=e("Network error. Please check your connection and try again.","digicommerce"):m.message.includes("413")||m.message.includes("payload too large")?f=e("File too large for upload. Please try a smaller file.","digicommerce"):m.message.includes("timeout")&&(f=e("Upload timed out. Please try again.","digicommerce")),wp.data.dispatch("core/notices").createNotice("error",f,{type:"snackbar"}),m}};return{initFileUpload:i,handleFileUpload:o,removeFile:async(v,t)=>{if(!v)return wp.data.dispatch("core/notices").createNotice("error",e("File not found for removal.","digicommerce"),{type:"snackbar"}),!1;try{let s=await wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:v,is_s3:v.s3||digicommerceVars.s3_enabled}});if(s.success){let m=s.message;return s.status==="not_found"?m=digicommerceVars.s3_enabled?e("File removed from product (was already deleted from S3)","digicommerce"):e("File removed from product (was already deleted from server)","digicommerce"):digicommerceVars.s3_enabled&&(m=e("File successfully removed from S3","digicommerce")),wp.data.dispatch("core/notices").createNotice("success",m,{type:"snackbar"}),t&&t(),!0}}catch(s){console.error("Error deleting file:",s);let m=s.message||e("Failed to delete file. Please try again.","digicommerce");return digicommerceVars.s3_enabled&&s.message.includes("S3")&&(m=e("Failed to delete file from S3. Please try again.","digicommerce")),wp.data.dispatch("core/notices").createNotice("error",m,{type:"snackbar"}),!1}}}})(),ce=({isOpen:i,onClose:o,onSave:l,initialVersion:v="",initialChangelog:t=""})=>{let[s,m]=P(v),[f,h]=P(t);x(()=>{i&&(m(v),h(t))},[i,v,t]);let a=()=>{if(!s.trim()){wp.data.dispatch("core/notices").createNotice("error",e("Version number is required.","digicommerce"),{type:"snackbar"});return}if(!/^\d+\.\d+\.\d+$/.test(s.trim())){wp.data.dispatch("core/notices").createNotice("error",e("Please use semantic versioning (e.g., 1.0.5)","digicommerce"),{type:"snackbar"});return}l({version:s.trim(),changelog:f.trim(),release_date:new Date().toISOString()}),o()};return i?React.createElement(Z,{title:e(v?"Edit Version":"Add Version","digicommerce"),onRequestClose:o,className:"digi-version-modal"},React.createElement("div",{className:"digi-version-modal-content"},React.createElement(y,{label:e("Version Number","digicommerce"),value:s,onChange:m,placeholder:"1.0.0",__nextHasNoMarginBottom:!0}),React.createElement(A,{label:e("Changelog","digicommerce"),value:f,onChange:h,rows:4,__nextHasNoMarginBottom:!0}),React.createElement("div",{className:"digi-version-modal-footer"},React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:o},e("Cancel","digicommerce")),React.createElement(N,{variant:"primary",onClick:a},e("Save","digicommerce"))))):null},ne=({versions:i,onDeleteVersion:o,onEditVersion:l})=>React.createElement("div",{className:"digi-version-list"},i.map((v,t)=>React.createElement(V,{key:t,className:"digi-version-item"},React.createElement("div",{className:"digi-version-list-header"},React.createElement("div",{className:"digi-version-list-title"},e("Version","digicommerce")," ",v.version,React.createElement("div",{className:"digi-version-actions"},React.createElement(N,{variant:"secondary",onClick:()=>l(t),className:"digi-edit-version"},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"12",height:"12"},React.createElement("path",{d:"M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"}))),React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>o(t),className:"digi-delete-version"},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"12",height:"12"},React.createElement("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"}))))))))),K=({versions:i=[],onUpdateVersions:o})=>{let[l,v]=P(!1),[t,s]=P(null),m=g=>{if(t!==null){let p=[...i];p[t]=g,o(p),s(null)}else{let p=[...i,g];o(p)}},f=g=>{s(g),v(!0)},h=()=>{v(!1),s(null)},a=g=>{let p=i.filter((u,d)=>d!==g);o(p)};return React.createElement("div",{className:"digi-version-manager"},React.createElement("div",{className:"digi-version-header"},React.createElement("h3",null,e("Versions","digicommerce")),React.createElement(N,{variant:"secondary",onClick:()=>v(!0),className:"digi-add-version"},e("Add","digicommerce"))),React.createElement(ne,{versions:i,onDeleteVersion:a,onEditVersion:f}),l&&React.createElement(ce,{isOpen:l,onClose:h,onSave:m,initialVersion:t!==null?i[t].version:"",initialChangelog:t!==null?i[t].changelog:""}))},X=({url:i})=>{let[o,l]=P(e("Click to copy","digicommerce")),[v,t]=P(!1),s=async()=>{try{await navigator.clipboard.writeText(i),l(e("Link copied","digicommerce")),setTimeout(()=>{l(e("Click to copy","digicommerce"))},2e3)}catch(m){console.error("Failed to copy:",m)}};return React.createElement("div",{className:"digi-url-field",onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1)},React.createElement(y,{label:e("Direct Purchase URL","digicommerce"),value:i,onClick:s,style:{cursor:"pointer"},readOnly:!0,__nextHasNoMarginBottom:!0}),v&&React.createElement("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#1e1e1e",color:"white",padding:"6px 12px",borderRadius:"4px",fontSize:"12px",marginTop:"4px",zIndex:1e3,pointerEvents:"none",whiteSpace:"nowrap"}},o,React.createElement("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid #1e1e1e"}})))},de=({variation:i,index:o,onUpdate:l,onRemove:v,onDragStart:t,onDragOver:s,onDrop:m,onDragLeave:f,onDragEnd:h})=>{let a=async c=>{let w=[...i.files||[],c];l(o,{...i,files:w})},g=async c=>{let w=i.files[c],C=i.files.filter((B,U)=>U!==c);l(o,{...i,files:C}),await I.removeFile(w,()=>{})||l(o,{...i,files:[...i.files]})},p=S(c=>c("core/editor").getCurrentPostId()),u=digicommerceVars.checkout_page_id||"",d=()=>u?`${wp.url.addQueryArgs(digicommerceVars.checkout_url,{})}`:"",b=wp.url.addQueryArgs(d(),{id:p,variation:o+1}),F=(c,w)=>{let C=[...i.files];C[c]={...C[c],versions:w},l(o,{...i,files:C})};return React.createElement(V,{className:"digi-variation-row digi-row",draggable:!0,onDragStart:c=>t(c,o),onDragOver:c=>s(c),onDrop:c=>m(c,o),onDragLeave:c=>f(c),onDragEnd:c=>h(c)},React.createElement(H,null,React.createElement("div",{className:"digi-inputs"},React.createElement(y,{label:e("Name","digicommerce"),value:i.name,onChange:c=>l(o,{...i,name:c}),placeholder:e("e.g., Single Site License","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Regular Price","digicommerce"),value:i.price,onChange:c=>{if(c===""){l(o,{...i,price:""});return}let w=parseFloat(c);isNaN(w)||(i.salePrice&&parseFloat(i.salePrice)>=w?l(o,{...i,price:w,salePrice:""}):l(o,{...i,price:w}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Sale Price","digicommerce"),value:i.salePrice||"",onChange:c=>{if(c===""){l(o,{...i,salePrice:""});return}let w=parseFloat(c);isNaN(w)||l(o,{...i,salePrice:w})},onBlur:c=>{let w=parseFloat(c.target.value),C=parseFloat(i.price);w&&C&&w>=C&&(wp.data.dispatch("core/notices").createNotice("error",e("Sale price must be less than regular price","digicommerce"),{type:"snackbar"}),l(o,{...i,salePrice:""}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(O,{label:e("Selected by default","digicommerce"),checked:i.isDefault||!1,onChange:c=>l(o,{...i,isDefault:c}),__nextHasNoMarginBottom:!0}),React.createElement(X,{url:b})),React.createElement("div",{className:"digi-variation-files"},i.files&&i.files.length>0&&React.createElement("p",null,e("Download File:","digicommerce")),i.files&&i.files.map((c,w)=>React.createElement(V,{key:w,className:"digi-card"},React.createElement(H,{className:"digi-card-body"},React.createElement("div",{className:"digi-inputs"},React.createElement(y,{label:e("File Name","digicommerce"),value:c.name,onChange:C=>{let L=[...i.files];L[w]={...c,name:C},l(o,{...i,files:L})},__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("File Path","digicommerce"),value:c.file,disabled:!0,__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Item Name","digicommerce"),value:c.itemName||"",onChange:C=>{let L=[...i.files];L[w]={...c,itemName:C},l(o,{...i,files:L})},placeholder:e("Enter item name","digicommerce"),__nextHasNoMarginBottom:!0})),digicommerceVars.license_enabled&&React.createElement("div",{className:"digi-version-section"},React.createElement(K,{versions:c.versions||[],onUpdateVersions:C=>F(w,C)})),React.createElement("div",{className:"digi-file-actions"},React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>g(w)},e("Remove File","digicommerce")))))),React.createElement(N,{variant:"secondary",onClick:()=>I.initFileUpload(a),className:"digi-add-button"},e("Add Download File","digicommerce"))),React.createElement("div",{className:"digi-variation-slots"},React.createElement(Q,{name:`DigiCommerceVariablePriceAfter-${o}`,fillProps:{variation:i,index:o,onUpdate:l}})),React.createElement("div",{className:"digi-actions"},React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>v(o),className:"digi-remove-button"},e("Remove Variation","digicommerce")))))},le=({file:i,index:o,onUpdate:l,onRemove:v,onDragStart:t,onDragOver:s,onDrop:m,onDragLeave:f,onDragEnd:h})=>{let a=g=>{l(o,{...i,versions:g})};return React.createElement(V,{className:"digi-file-row digi-row",draggable:!0,onDragStart:g=>t(g,o),onDragOver:g=>s(g),onDrop:g=>m(g,o),onDragLeave:g=>f(g),onDragEnd:g=>h(g)},React.createElement(H,null,React.createElement("div",{className:"digi-inputs"},React.createElement(y,{label:e("File Name","digicommerce"),value:i.name,onChange:g=>l(o,{...i,name:g}),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("File Path","digicommerce"),value:i.file,onChange:g=>l(o,{...i,file:g}),disabled:!0,__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Item Name","digicommerce"),value:i.itemName||"",onChange:g=>{let p={...i,itemName:g};l(o,p)},placeholder:e("Enter item name","digicommerce"),__nextHasNoMarginBottom:!0})),digicommerceVars.license_enabled&&React.createElement("div",{className:"digi-version-section"},React.createElement(K,{versions:i.versions||[],onUpdateVersions:a})),React.createElement("div",{className:"digi-actions"},React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>v(o)},e("Remove File","digicommerce")))))},me=({feature:i,index:o,onUpdate:l,onRemove:v,onDragStart:t,onDragOver:s,onDrop:m,onDragLeave:f,onDragEnd:h})=>React.createElement(V,{className:"digi-feature-row digi-row",draggable:!0,onDragStart:a=>t(a,o),onDragOver:a=>s(a),onDrop:a=>m(a,o),onDragLeave:a=>f(a),onDragEnd:a=>h(a)},React.createElement(H,null,React.createElement("div",{className:"digi-inputs"},React.createElement(y,{label:e("Name","digicommerce"),value:i.name,onChange:a=>l(o,{...i,name:a}),placeholder:e("Name","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Text","digicommerce"),value:i.text,onChange:a=>l(o,{...i,text:a}),placeholder:e("Text","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-actions"},React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>v(o),className:"digi-remove-button"},e("Remove Feature","digicommerce"))))),ge=()=>{let[i,o]=P([]),[l,v]=P([]),t=S(p=>p("core/editor").getCurrentPostId()),{editPost:s}=E("core/editor"),m=S(p=>p("core/editor").getEditedPostAttribute("meta"));x(()=>{wp.apiFetch({path:"/wp/v2/digi_product?per_page=-1",_fields:"id,title,meta"}).then(p=>{let u=p.filter(d=>d.meta?.digi_license_enabled===!0||d.meta?.digi_price_variations&&d.meta.digi_price_variations.some(b=>b.license_enabled));v(u)})},[]),x(()=>{m?.digi_upgrade_paths&&o(m.digi_upgrade_paths)},[m?.digi_upgrade_paths]);let f=()=>{let p={product_id:"",variation_id:"",prorate:!1,include_coupon:!1,discount_type:"fixed",discount_amount:""},u=[...i,p];o(u),s({meta:{digi_upgrade_paths:u}})},h=(p,u,d)=>{let b=[...i];b[p]={...b[p],[u]:d},o(b),s({meta:{digi_upgrade_paths:b}})},a=p=>{let u=i.filter((d,b)=>b!==p);o(u),s({meta:{digi_upgrade_paths:u}})};return!digicommerceVars.pro_active||!digicommerceVars.license_enabled||!(m?.digi_license_enabled||m?.digi_price_variations&&m.digi_price_variations.some(p=>p.license_enabled))?null:React.createElement(k,{title:e("Upgrade Paths","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},i.map((p,u)=>React.createElement(V,{key:u,className:"digi-upgrade-path-card"},React.createElement(H,{className:"digi-inputs"},React.createElement(T,{label:e("Target Product","digicommerce"),value:p.product_id,options:[{label:e("Select a product...","digicommerce"),value:""},...l.map(d=>({label:d.title.rendered,value:d.id.toString()}))],onChange:d=>h(u,"product_id",d),__nextHasNoMarginBottom:!0}),p.product_id&&l.find(d=>d.id===parseInt(p.product_id))?.meta?.digi_price_mode==="variations"&&React.createElement(T,{label:e("Target Variation","digicommerce"),value:p.variation_id,options:[{label:e("Select a variation...","digicommerce"),value:""},...l.find(d=>d.id===parseInt(p.product_id)).meta.digi_price_variations.filter(d=>d.license_enabled).map(d=>({label:d.name,value:d.id}))],onChange:d=>h(u,"variation_id",d),__nextHasNoMarginBottom:!0}),React.createElement(O,{label:e("Prorate","digicommerce"),checked:p.prorate,onChange:d=>h(u,"prorate",d),__nextHasNoMarginBottom:!0}),React.createElement(O,{label:e("Include Coupon","digicommerce"),checked:p.include_coupon,onChange:d=>h(u,"include_coupon",d),__nextHasNoMarginBottom:!0}),p.include_coupon&&React.createElement(React.Fragment,null,React.createElement(T,{label:e("Discount Type","digicommerce"),value:p.discount_type,options:[{label:e("Fixed Amount","digicommerce"),value:"fixed"},{label:e("Percentage","digicommerce"),value:"percentage"}],onChange:d=>h(u,"discount_type",d),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Amount","digicommerce"),type:"number",value:p.discount_amount,onChange:d=>h(u,"discount_amount",d),min:"0",step:p.discount_type==="percentage"?"1":"0.01",__nextHasNoMarginBottom:!0})),React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>a(u),className:"digi-remove-button"},e("Remove Path","digicommerce"))))),React.createElement(N,{variant:"primary",onClick:f,className:"digi-add-button"},e("Add Upgrade Path","digicommerce"))))},ue=({isOpen:i,onClose:o,initialData:l={},onSave:v})=>{let[t,s]=P({homepage:"",author:"",requires:"",requires_php:"",tested:"",description:"",installation:"",upgrade_notice:"",icons:{default:""},banners:{low:"",high:""},contributors:[],...l});x(()=>{i&&s({homepage:"",author:"",requires:"",requires_php:"",tested:"",description:"",installation:"",upgrade_notice:"",icons:{default:""},banners:{low:"",high:""},contributors:[],...l})},[i,l]);let m=()=>{s({...t,contributors:[...t.contributors,{username:"",avatar:"",name:""}]})},f=a=>{let g=[...t.contributors];g.splice(a,1),s({...t,contributors:g})},h=(a,g)=>{let p=[...t.contributors];p[a]=g,s({...t,contributors:p})};return i?React.createElement(Z,{title:e("API Data","digicommerce"),onRequestClose:o,className:"digi-api-modal"},React.createElement("div",{className:"digi-api-modal-content"},React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Basic Information","digicommerce")),React.createElement(y,{label:e("Homepage","digicommerce"),type:"url",value:t.homepage,onChange:a=>s({...t,homepage:a}),help:e("Plugin homepage URL.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Author","digicommerce"),value:t.author,onChange:a=>s({...t,author:a}),help:e("Author information with optional link.","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Requirements","digicommerce")),React.createElement(y,{label:e("Requires WordPress Version","digicommerce"),value:t.requires,onChange:a=>s({...t,requires:a}),help:e("Minimum required WordPress version.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Requires PHP Version","digicommerce"),value:t.requires_php,onChange:a=>s({...t,requires_php:a}),help:e("Minimum required PHP version.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Tested up to","digicommerce"),value:t.tested,onChange:a=>s({...t,tested:a}),help:e("WordPress version the plugin has been tested up to.","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Description & Installation","digicommerce")),React.createElement(A,{label:e("Description","digicommerce"),value:t.description,onChange:a=>s({...t,description:a}),help:e("Full description of the plugin (HTML allowed).","digicommerce"),rows:4,__nextHasNoMarginBottom:!0}),React.createElement(A,{label:e("Installation","digicommerce"),value:t.installation,onChange:a=>s({...t,installation:a}),help:e("Installation instructions (HTML allowed).","digicommerce"),rows:4,__nextHasNoMarginBottom:!0}),React.createElement(A,{label:e("Upgrade Notice","digicommerce"),value:t.upgrade_notice,onChange:a=>s({...t,upgrade_notice:a}),help:e("Upgrade notices for your users.","digicommerce"),rows:2,__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Assets","digicommerce")),React.createElement(y,{label:e("Plugin Icon URL","digicommerce"),type:"url",value:t.icons.default,onChange:a=>s({...t,icons:{default:a}}),help:e("URL to your plugin's icon (256x256px).","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Banner Low Resolution URL","digicommerce"),type:"url",value:t.banners.low,onChange:a=>s({...t,banners:{...t.banners,low:a}}),help:e("URL to your plugin's low resolution banner (772x250px).","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Banner High Resolution URL","digicommerce"),type:"url",value:t.banners.high,onChange:a=>s({...t,banners:{...t.banners,high:a}}),help:e("URL to your plugin's high resolution banner (1544x500px).","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Contributors","digicommerce")),React.createElement("div",{className:"digi-contributor-wrap"},t.contributors.map((a,g)=>React.createElement("div",{key:g,className:"digi-contributor-row"},React.createElement("div",{className:"digi-contributor-fields"},React.createElement(y,{value:a.username||"",onChange:p=>h(g,{...a,username:p}),placeholder:e("WordPress.org username","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{value:a.name||"",onChange:p=>h(g,{...a,name:p}),placeholder:e("Display Name","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(y,{value:a.avatar||"",onChange:p=>h(g,{...a,avatar:p}),type:"url",placeholder:e("Avatar URL","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement(N,{isDestructive:!0,variant:"secondary",onClick:()=>f(g),icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"},React.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}))}))),React.createElement(N,{variant:"secondary",onClick:()=>m(),className:"digi-add-contributor"},e("Add Contributor","digicommerce")))),React.createElement("div",{className:"digi-api-modal-footer"},React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:o},e("Cancel","digicommerce")),React.createElement(N,{variant:"primary",onClick:()=>v(t)},e("Save","digicommerce"))))):null},pe=()=>{let[i,o]=P(!1),{editPost:l}=E("core/editor"),v=S(t=>t("core/editor").getEditedPostAttribute("meta"));return!digicommerceVars.pro_active||!digicommerceVars.license_enabled?null:React.createElement(k,{title:e("API Data","digicommerce"),initialOpen:!1},!v?.digi_api_data||Object.keys(v.digi_api_data).length===0?React.createElement(N,{variant:"primary",onClick:()=>o(!0),className:"digi-add-button"},e("Add API Data","digicommerce")):React.createElement("div",{className:"digi-api-data-preview"},React.createElement(N,{variant:"primary",onClick:()=>o(!0)},e("Edit API Data","digicommerce")),React.createElement("div",{className:"digi-api-data-info"},React.createElement("span",null,React.createElement("strong",null,e("Requires:","digicommerce"))," WordPress ",v.digi_api_data.requires),React.createElement("span",null,React.createElement("strong",null,e("Tested up to:","digicommerce"))," ",v.digi_api_data.tested))),i&&React.createElement(ue,{isOpen:i,onClose:()=>o(!1),initialData:v?.digi_api_data,onSave:t=>{l({meta:{digi_api_data:t}}),o(!1)}}))},ve=()=>{let[i,o]=P([]),[l,v]=P([]),[t,s]=P([]),{editPost:m}=E("core/editor"),f=S(u=>u("core/editor").getEditedPostAttribute("meta")),h=S(u=>u("core/editor").getCurrentPostId());x(()=>{wp.apiFetch({path:"/wp/v2/digi_product?per_page=-1&status=publish",_fields:"id,title,meta"}).then(u=>{let d=u.filter(b=>b.id!==h);v(d)}).catch(u=>{console.error("Error fetching products:",u)})},[h]),x(()=>{let u=f?.digi_bundle_products,d=Array.isArray(u)?u:[];o(d)},[f?.digi_bundle_products]),x(()=>{if(i.length>0&&l.length>0){let u=i.filter(d=>d&&d!=="").map(d=>{let b=l.find(F=>F.id===parseInt(d));if(b){let F=b.meta?.digi_files||[],c=Array.isArray(F)?F.length:0;return{id:b.id,name:b.title.rendered,fileCount:c}}return null}).filter(Boolean);s(u)}else s([])},[i,l]);let a=()=>{let u=[...i,""];o(u),m({meta:{digi_bundle_products:u}})},g=(u,d)=>{let b=[...i];b[u]=d,o(b),m({meta:{digi_bundle_products:b}})},p=u=>{let d=i.filter((b,F)=>F!==u);o(d),m({meta:{digi_bundle_products:d}})};return React.createElement(k,{title:e("Bundle Products","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},React.createElement("div",{className:"digi-bundle-info"},React.createElement("p",null,e("Select products to include in this bundle. Customer will receive downloads for all selected products.","digicommerce")),digicommerceVars.license_enabled&&React.createElement("p",{className:"text-sm text-gray-600 italic"},e("If this bundle product has license system enabled, customers will get one master license that works for all bundled products.","digicommerce"))),i.map((u,d)=>React.createElement(V,{key:d,className:"digi-bundle-product-card"},React.createElement(H,{className:"digi-inputs"},React.createElement(T,{label:e("Product","digicommerce"),value:u,options:[{label:e("Select a product...","digicommerce"),value:""},...l.map(b=>({label:b.title.rendered,value:b.id.toString()}))],onChange:b=>g(d,b),__nextHasNoMarginBottom:!0}),React.createElement(N,{variant:"secondary",isDestructive:!0,onClick:()=>p(d),className:"digi-remove-button"},e("Remove Product","digicommerce"))))),React.createElement(N,{variant:"primary",onClick:a,className:"digi-add-button"},e("Add Product","digicommerce")),t.length>0&&React.createElement(V,{className:"digi-bundle-preview",style:{marginTop:"20px",backgroundColor:"#f8f9fa"}},React.createElement(H,null,React.createElement("h4",{style:{margin:"0 0 10px 0",fontSize:"14px",fontWeight:"600"}},e("Bundle Preview","digicommerce")),React.createElement("div",{style:{fontSize:"13px",color:"#666"}},React.createElement("p",{style:{margin:"0 0 8px 0"}},sprintf(e("This bundle includes %d products:","digicommerce"),t.length)),React.createElement("ul",{style:{margin:"0"}},t.map(u=>React.createElement("li",{key:u.id,style:{marginBottom:"4px"}},React.createElement("strong",null,u.name),u.fileCount>0&&React.createElement("span",{style:{color:"#888",fontSize:"12px"}}," ","(",sprintf(e("%d files","digicommerce"),u.fileCount),")")))),React.createElement("p",{style:{margin:"8px 0 0 0",fontSize:"12px",fontStyle:"italic"}},e("Customers will get one master license that works for all bundled products.","digicommerce")))))))};ee("digi-product-sidebar",{render:()=>{let[i,o]=P(0),[l,v]=P(""),[t,s]=P([]),[m,f]=P([]),[h,a]=P("single"),[g,p]=P(""),[u,d]=P([]),[b,F]=P(""),{editPost:c}=E("core/editor"),w=S(r=>r("core/editor").getCurrentPostId()),C=digicommerceVars.checkout_page_id||"",L=()=>C?`${wp.url.addQueryArgs(digicommerceVars.checkout_url,{})}`:"",B=S(r=>r("core/editor").getEditedPostAttribute("meta"));x(()=>{B&&(o(B.digi_price||0),v(B.digi_sale_price||""),s(B.digi_files||[]),f(B.digi_price_variations||[]),a(B.digi_price_mode||"single"),p(B.digi_product_description||""),d(B.digi_features||[]),F(B.digi_instructions||""))},[B]);let U=async r=>{let n=[...t,r];s(n),c({meta:{digi_files:n}})},he=(r,n)=>{let _=[...t];_[r]=n,s(_),c({meta:{digi_files:_}})},_e=async r=>{let n=t[r],_=t.filter((D,R)=>R!==r);s(_),c({meta:{digi_files:_}}),await I.removeFile(n,()=>{})||(s([...t]),c({meta:{digi_files:[...t]}}))},J=r=>{a(r),c({meta:{digi_price_mode:r}})},fe=()=>{let n={id:Date.now().toString()+Math.random().toString(36).substr(2,5),name:"",price:0,salePrice:null,files:[],subscription_enabled:!1,subscription_period:"month",subscription_free_trial:{duration:0,period:"days"},subscription_signup_fee:0},_=[...m,n];f(_),c({meta:{digi_price_variations:_}})},be=(r,n)=>{let _=[...m];_[r]=n,f(_),c({meta:{digi_price_variations:_}})},ye=async r=>{let n=m[r];if(n.files&&n.files.length>0)for(let M of n.files)try{await I.removeFile(M)}catch(D){console.error("Error deleting variation file:",D),wp.data.dispatch("core/notices").createNotice("error",e("Error deleting some files, but variation was removed","digicommerce"),{type:"snackbar"})}let _=m.filter((M,D)=>D!==r);f(_),c({meta:{digi_price_variations:_}}),wp.data.dispatch("core/notices").createNotice("success",digicommerceVars.s3_enabled?e("Variation and associated S3 files removed successfully","digicommerce"):e("Variation removed successfully","digicommerce"),{type:"snackbar"})},Ne=()=>{let r={name:"",text:""},n=[...u,r];d(n),c({meta:{digi_features:n}})},we=(r,n)=>{let _=[...u];_[r]=n,d(_),c({meta:{digi_features:_}})},Pe=r=>{let n=u.filter((_,M)=>M!==r);d(n),c({meta:{digi_features:n}})},q=(r,n)=>{r.dataTransfer.setData("text/plain",n),r.currentTarget.classList.add("is-dragging")},W=r=>{r.preventDefault(),r.currentTarget.classList.add("is-drag-over")},G=r=>{r.currentTarget.classList.remove("is-drag-over"),r.currentTarget.classList.remove("is-dragging")},$=r=>{r.currentTarget.classList.remove("is-dragging"),r.currentTarget.classList.remove("is-drag-over"),document.querySelectorAll(".digi-file-row, .digi-variation-row, .digi-feature-row").forEach(n=>{n.classList.remove("is-drag-over"),n.classList.remove("is-dragging")})},j=(r,n,_,M,D)=>{r.preventDefault(),r.currentTarget.classList.remove("is-drag-over"),r.currentTarget.classList.remove("is-dragging");let R=parseInt(r.dataTransfer.getData("text/plain"));if(R===n)return;let z=[..._],[Fe]=z.splice(R,1);z.splice(n,0,Fe),M(z),c({meta:{[D]:z}}),document.querySelectorAll(".digi-file-row, .digi-variation-row, .digi-feature-row").forEach(Y=>{Y.classList.remove("is-drag-over"),Y.classList.remove("is-dragging")})},Ce=(r,n)=>j(r,n,t,s,"digi_files"),Be=(r,n)=>j(r,n,m,f,"digi_price_variations"),Me=(r,n)=>j(r,n,u,d,"digi_features");return React.createElement(React.Fragment,null,React.createElement(te,{target:"product-details"},e("Product Details","digicommerce")),React.createElement(ie,{name:"product-details",title:e("Product Details","digicommerce"),className:"digi-product-sidebar"},React.createElement(k,{title:e("Pricing","digicommerce"),initialOpen:!0},React.createElement("div",{className:"digi-price-mode-toggle"},React.createElement(oe,{className:"digi-price-mode-buttons"},React.createElement(N,{variant:h==="single"?"primary":"secondary",onClick:()=>J("single"),className:"digi-price-mode-button"},e("Single Price","digicommerce")),React.createElement(N,{variant:h==="variations"?"primary":"secondary",onClick:()=>J("variations"),className:"digi-price-mode-button"},e("Price Variations","digicommerce")))),h==="single"?React.createElement("div",{className:"digi-inputs"},React.createElement(y,{label:e("Regular Price","digicommerce"),value:i,onChange:r=>{if(r===""){o("");return}let n=parseFloat(r);isNaN(n)||(o(n),c({meta:{digi_price:n}}),l&&parseFloat(l)>=n&&(v(""),c({meta:{digi_sale_price:""}})))},onBlur:()=>{let r=parseFloat(i)||0;o(r),c({meta:{digi_price:r}})},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(y,{label:e("Sale Price","digicommerce"),value:l,onChange:r=>{if(r===""){v(""),c({meta:{digi_sale_price:""}});return}let n=parseFloat(r);isNaN(n)||(v(n),c({meta:{digi_sale_price:n}}))},onBlur:r=>{let n=parseFloat(r.target.value),_=parseFloat(i);n&&_&&n>=_&&(wp.data.dispatch("core/notices").createNotice("error",e("Sale price must be less than regular price","digicommerce"),{type:"snackbar"}),v(""),c({meta:{digi_sale_price:""}}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(X,{url:wp.url.addQueryArgs(L(),{id:w})}),React.createElement("div",{className:"digi-slot-container"},React.createElement(Q,{name:"DigiCommerceSinglePriceAfter"}))):React.createElement("div",{className:"digi-variations-section"},React.createElement("div",{className:"digi-container"},m.map((r,n)=>React.createElement(de,{key:n,variation:r,index:n,onUpdate:be,onRemove:ye,onDragStart:q,onDragOver:W,onDrop:Be,onDragLeave:G,onDragEnd:$}))),React.createElement(N,{variant:"primary",onClick:fe,className:"digi-add-button"},e("Add Price Variation","digicommerce")))),React.createElement(k,{title:e("Downloadable Files","digicommerce"),initialOpen:!1},t.length>0&&React.createElement("div",{style:{display:"flex",backgroundColor:"#f6f7f9",borderRadius:"0.75rem",fontSize:"0.7rem",marginBottom:"1.5rem",padding:"1rem",alignItems:"center"}},digicommerceVars.s3_enabled?e("NOTE: When a file is removed, it is completely removed from your S3 bucket.","digicommerce"):e("NOTE: When a file is removed, it is completely removed from your server.","digicommerce")),React.createElement("div",{className:"digi-container"},t.map((r,n)=>React.createElement(le,{key:n,file:r,index:n,onUpdate:he,onRemove:_e,onDragStart:q,onDragOver:W,onDrop:Ce,onDragLeave:G,onDragEnd:$}))),React.createElement(N,{variant:"primary",onClick:()=>I.initFileUpload(U),className:"digi-add-button"},e("Add New File","digicommerce"))),React.createElement(k,{title:e("Description","digicommerce"),initialOpen:!1},React.createElement(A,{help:e("Add a detailed description for your product.","digicommerce"),value:g,onChange:r=>{p(r),c({meta:{digi_product_description:r}})},rows:4,__nextHasNoMarginBottom:!0})),React.createElement(k,{title:e("Gallery","digicommerce"),initialOpen:!1},React.createElement(re,null,React.createElement(ae,{onSelect:r=>{let n=r.map(_=>({id:_.id,url:_.sizes?.medium?.url||_.url,alt:_.alt||""}));c({meta:{digi_gallery:n}})},allowedTypes:["image"],multiple:!0,gallery:!0,value:B?.digi_gallery?.map(r=>r.id)||[],render:({open:r})=>React.createElement("div",null,React.createElement("div",{className:"digi-gallery-grid"},(B?.digi_gallery||[]).map((n,_)=>React.createElement("div",{key:_,className:"digi-gallery-item",onClick:r,role:"button",tabIndex:0,onKeyDown:M=>{(M.key==="Enter"||M.key===" ")&&r()}},React.createElement("img",{src:n.url,alt:n.alt,className:"digi-gallery-image"}),React.createElement("button",{type:"button",onClick:M=>{M.stopPropagation();let D=[...B.digi_gallery||[]];D.splice(_,1),c({meta:{digi_gallery:D}})},className:"digi-remove-gallery-image"},React.createElement("span",{className:"sr-only"},e("Remove image","digicommerce")),React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2"},React.createElement("path",{d:"M18 6L6 18M6 6l12 12"})))))),React.createElement(N,{variant:"primary",onClick:r,className:"digi-add-button"},B?.digi_gallery?.length?e("Edit Gallery","digicommerce"):e("Add Gallery Images","digicommerce")))}))),React.createElement(k,{title:e("Features","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},u.map((r,n)=>React.createElement(me,{key:n,feature:r,index:n,onUpdate:we,onRemove:Pe,onDragStart:q,onDragOver:W,onDrop:Me,onDragLeave:G,onDragEnd:$}))),React.createElement(N,{variant:"primary",onClick:Ne,className:"digi-add-button"},e("Add Feature","digicommerce"))),React.createElement(k,{title:e("Download Instructions","digicommerce"),initialOpen:!1},React.createElement(A,{label:e("Instructions for customers","digicommerce"),help:e("These instructions will be shown to customers after purchase","digicommerce"),value:b,onChange:r=>{F(r),c({meta:{digi_instructions:r}})},rows:4,__nextHasNoMarginBottom:!0})),React.createElement(ge,null),React.createElement(pe,null),React.createElement(ve,null)))},icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"24",height:"24",fill:"currentColor",className:"digi__icon"},React.createElement("circle",{cx:"256",cy:"256",r:"256"}),React.createElement("path",{d:"M361.4858,348.7728c4.6805,0,8.9099,1.8997,11.9904,4.96,3.1729,3.177,4.952,7.4854,4.9451,11.9755,0,4.672-1.8912,8.9099-4.9451,11.9701-3.1801,3.1788-7.494,4.9621-11.9904,4.9568-4.4924.0071-8.8023-1.7768-11.9755-4.9568-3.1781-3.1723-4.9618-7.4797-4.9568-11.9701,0-4.6805,1.8965-8.9099,4.9568-11.9755,3.1739-3.1794,7.483-4.9641,11.9755-4.96h0ZM199.2159,348.7728c4.6795,0,8.9152,1.8997,11.9755,4.96,3.1815,3.1724,4.9663,7.4826,4.9589,11.9755,0,4.672-1.8933,8.9099-4.9589,11.9701-3.1722,3.1815-7.4827,4.9657-11.9755,4.9568-4.491.0081-8.7996-1.7761-11.9701-4.9568-3.1808-3.1707-4.9656-7.479-4.9589-11.9701,0-4.6805,1.8933-8.9099,4.9589-11.9755,3.1712-3.1801,7.4791-4.9652,11.9701-4.96h0ZM145.0057,129.3637l8.0203,33.6693h-43.2928c-3.9738,0-7.1952,3.2214-7.1952,7.1952s3.2214,7.1952,7.1952,7.1952h100.7712c3.9729,0,7.1936,3.2207,7.1936,7.1936s-3.2207,7.1936-7.1936,7.1936h-50.6219l2.4341,10.2304h-9.0208c-3.9738,0-7.1952,3.2214-7.1952,7.1952s3.2214,7.1952,7.1952,7.1952h64.6784c3.9738.0484,7.1559,3.3091,7.1075,7.2829-.0476,3.9055-3.202,7.0599-7.1075,7.1075h-48.8075l2.528,10.6197h-57.4848c-3.9712,0-7.1904,3.2203-7.1904,7.1936s3.2203,7.1936,7.1904,7.1936h113.7248c3.9738.0481,7.1562,3.3084,7.1082,7.2822-.0472,3.906-3.2022,7.0609-7.1082,7.1082h-49.3802l2.6699,11.2192c-6.3669.7413-12.0949,3.6533-16.4149,7.9669-5.0325,5.0379-8.1557,11.9872-8.1557,19.6373s3.1243,14.6027,8.1557,19.6352c5.0379,5.0411,11.9872,8.1621,19.6437,8.1621h2.5835c-3.7221,1.5774-7.1056,3.8568-9.9659,6.7136-5.8861,5.8685-9.1892,13.8418-9.1776,22.1536,0,8.6475,3.5051,16.4757,9.1776,22.1451,5.6693,5.6693,13.5029,9.1744,22.1451,9.1744,8.6475,0,16.4843-3.5051,22.1536-9.1744,5.6693-5.6693,9.1744-13.4976,9.1744-22.1451.0113-8.3111-3.2904-16.2839-9.1744-22.1536-2.8615-2.8568-6.2461-5.1361-9.9691-6.7136h137.8997c-3.7203,1.5773-7.1018,3.8567-9.9595,6.7136-5.6693,5.6693-9.1776,13.5029-9.1776,22.1536s3.5083,16.4757,9.1776,22.1451c5.6693,5.6693,13.4965,9.1744,22.1451,9.1744s16.4693-3.5051,22.1419-9.1744c5.6725-5.6693,9.1915-13.4976,9.1915-22.1451s-3.52-16.4843-9.1915-22.1536c-2.8512-2.8593-6.2294-5.1392-9.9477-6.7136h10.2677c3.9563,0,7.1851-3.2203,7.1851-7.1968s-3.2288-7.1968-7.1851-7.1968h-199.4944c-3.68,0-7.0304-1.5093-9.4688-3.9381-2.4288-2.4352-3.9445-5.7803-3.9445-9.4656,0-3.68,1.5157-7.0251,3.9445-9.4592,2.4373-2.4288,5.7888-3.9445,9.4688-3.9445h175.072c5.8261,0,11.2224-1.9488,15.5211-5.3291,4.2763-3.3653,7.4464-8.1472,8.8427-13.8368l25.3365-103.9563c.2353-.739.353-1.5104.3488-2.2859,0-3.9733-3.2-7.1968-7.1851-7.1968h-234.5749l-10.0736-42.2912c-.6792-3.3563-3.6295-5.7691-7.0539-5.7685h-30.1205c-3.9735-.0012-7.1956,3.219-7.1968,7.1925v.0043c0,3.9729,3.2207,7.1936,7.1936,7.1936h24.4427v-.0011Z",fill:"#fff"}))})})();})();
