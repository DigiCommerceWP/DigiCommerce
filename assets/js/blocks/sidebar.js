(()=>{(function(){let{registerPlugin:ae}=wp.plugins,{PluginSidebar:re,PluginSidebarMoreMenuItem:oe}=wp.editor,{MediaUpload:se,MediaUploadCheck:ce}=wp.blockEditor,{PanelBody:S,TextControl:h,Button:y,Card:L,CardBody:R,ButtonGroup:ne,TextareaControl:H,CheckboxControl:O,SelectControl:q,Slot:X,Modal:K}=wp.components,{useSelect:E,useDispatch:U}=wp.data,{useState:D,useEffect:x}=wp.element,{__:e}=wp.i18n,J=t=>t.replace(/\.[^/.]+$/,"").replace(/-/g," "),de=({isOpen:t,onClose:r,onSave:d,initialVersion:p="",initialChangelog:a=""})=>{let[l,v]=D(p),[C,f]=D(a);x(()=>{t&&(v(p),f(a))},[t,p,a]);let c=()=>{if(!l.trim()){wp.data.dispatch("core/notices").createNotice("error",e("Version number is required.","digicommerce"),{type:"snackbar"});return}if(!/^\d+\.\d+\.\d+$/.test(l.trim())){wp.data.dispatch("core/notices").createNotice("error",e("Please use semantic versioning (e.g., 1.0.5)","digicommerce"),{type:"snackbar"});return}d({version:l.trim(),changelog:C.trim(),release_date:new Date().toISOString()}),r()};return t?React.createElement(K,{title:e(p?"Edit Version":"Add Version","digicommerce"),onRequestClose:r,className:"digi-version-modal"},React.createElement("div",{className:"digi-version-modal-content"},React.createElement(h,{label:e("Version Number","digicommerce"),value:l,onChange:v,placeholder:"1.0.0",__nextHasNoMarginBottom:!0}),React.createElement(H,{label:e("Changelog","digicommerce"),value:C,onChange:f,rows:4,__nextHasNoMarginBottom:!0}),React.createElement("div",{className:"digi-version-modal-footer"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:r},e("Cancel","digicommerce")),React.createElement(y,{variant:"primary",onClick:c},e("Save","digicommerce"))))):null},le=({versions:t,onDeleteVersion:r,onEditVersion:d})=>React.createElement("div",{className:"digi-version-list"},t.map((p,a)=>React.createElement(L,{key:a,className:"digi-version-item"},React.createElement("div",{className:"digi-version-list-header"},React.createElement("div",{className:"digi-version-list-title"},e("Version","digicommerce")," ",p.version,React.createElement("div",{className:"digi-version-actions"},React.createElement(y,{variant:"secondary",onClick:()=>d(a),className:"digi-edit-version"},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"12",height:"12"},React.createElement("path",{d:"M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"}))),React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>r(a),className:"digi-delete-version"},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"12",height:"12"},React.createElement("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"}))))))))),Y=({versions:t=[],onUpdateVersions:r})=>{let[d,p]=D(!1),[a,l]=D(null),v=m=>{if(a!==null){let n=[...t];n[a]=m,r(n),l(null)}else{let n=[...t,m];r(n)}},C=m=>{l(m),p(!0)},f=()=>{p(!1),l(null)},c=m=>{let n=t.filter((_,g)=>g!==m);r(n)};return React.createElement("div",{className:"digi-version-manager"},React.createElement("div",{className:"digi-version-header"},React.createElement("h3",null,e("Versions","digicommerce")),React.createElement(y,{variant:"secondary",onClick:()=>p(!0),className:"digi-add-version"},e("Add","digicommerce"))),React.createElement(le,{versions:t,onDeleteVersion:c,onEditVersion:C}),d&&React.createElement(de,{isOpen:d,onClose:f,onSave:v,initialVersion:a!==null?t[a].version:"",initialChangelog:a!==null?t[a].changelog:""}))},ee=({url:t})=>{let[r,d]=D(e("Click to copy","digicommerce")),[p,a]=D(!1),l=async()=>{try{await navigator.clipboard.writeText(t),d(e("Link copied","digicommerce")),setTimeout(()=>{d(e("Click to copy","digicommerce"))},2e3)}catch(v){console.error("Failed to copy:",v)}};return React.createElement("div",{className:"digi-url-field",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1)},React.createElement(h,{label:e("Direct Purchase URL","digicommerce"),value:t,onClick:l,style:{cursor:"pointer"},readOnly:!0,__nextHasNoMarginBottom:!0}),p&&React.createElement("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#1e1e1e",color:"white",padding:"6px 12px",borderRadius:"4px",fontSize:"12px",marginTop:"4px",zIndex:1e3,pointerEvents:"none",whiteSpace:"nowrap"}},r,React.createElement("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid #1e1e1e"}})))},me=({variation:t,index:r,onUpdate:d,onRemove:p,onDragStart:a,onDragOver:l,onDrop:v,onDragLeave:C,onDragEnd:f})=>{let c=async()=>{let o=document.createElement("input");o.type="file",o.multiple=!1,o.addEventListener("change",async N=>{let B=N.target.files[0];if(!B)return;let P=new FormData;P.append("action","digicommerce_upload_file"),P.append("file",B),P.append("upload_nonce",digicommerceVars.upload_nonce);try{digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("info",digicommerceVars.i18n.s3_uploading,{type:"snackbar",isDismissible:!1}):wp.data.dispatch("core/notices").createNotice("info",e("Uploading file...","digicommerce"),{type:"snackbar",isDismissible:!1});let V=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:P})).json();if(V.success){let z={name:V.data.name,file:V.data.file,id:V.data.id,type:V.data.type,size:V.data.size,itemName:J(V.data.name)},W=[...t.files||[],z];d(r,{...t,files:W}),digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("success",e("File successfully uploaded to Amazon S3","digicommerce"),{type:"snackbar"}):wp.data.dispatch("core/notices").createNotice("success",e("File uploaded successfully","digicommerce"),{type:"snackbar"})}else if(V.data?.s3_error)wp.data.dispatch("core/notices").createNotice("error",digicommerceVars.i18n.s3_upload_failed,{type:"snackbar"});else throw new Error(V.data||"Upload failed")}catch(w){console.error("Upload error:",w),wp.data.dispatch("core/notices").createNotice("error",e("Upload failed. Please try again.","digicommerce"),{type:"snackbar"})}}),o.click()},m=async o=>{let N=t.files[o],B=t.files.filter((P,w)=>w!==o);d(r,{...t,files:B});try{let P=await wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:N}});if(P.success){let w=P.message;P.status==="not_found"&&(w=e("File removed from variation (was already deleted from server)","digicommerce")),wp.data.dispatch("core/notices").createNotice("success",w,{type:"snackbar"})}}catch(P){console.error("Error deleting file:",P),d(r,{...t,files:[...t.files]}),wp.data.dispatch("core/notices").createNotice("error",P.message||e("Failed to delete file. Please try again.","digicommerce"),{type:"snackbar"})}},n=E(o=>o("core/editor").getCurrentPostId()),_=digicommerceVars.checkout_page_id||"",g=()=>_?`${wp.url.addQueryArgs(digicommerceVars.checkout_url,{})}`:"",M=wp.url.addQueryArgs(g(),{id:n,variation:r+1}),A=(o,N)=>{let B=[...t.files];B[o]={...B[o],versions:N},d(r,{...t,files:B})};return React.createElement(L,{className:"digi-variation-row digi-row",draggable:!0,onDragStart:o=>a(o,r),onDragOver:o=>l(o),onDrop:o=>v(o,r),onDragLeave:o=>C(o),onDragEnd:o=>f(o)},React.createElement(R,null,React.createElement("div",{className:"digi-inputs"},React.createElement(h,{label:e("Name","digicommerce"),value:t.name,onChange:o=>d(r,{...t,name:o}),placeholder:e("e.g., Single Site License","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Regular Price","digicommerce"),value:t.price,onChange:o=>{if(o===""){d(r,{...t,price:""});return}let N=parseFloat(o);isNaN(N)||(t.salePrice&&parseFloat(t.salePrice)>=N?d(r,{...t,price:N,salePrice:""}):d(r,{...t,price:N}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Sale Price","digicommerce"),value:t.salePrice||"",onChange:o=>{if(o===""){d(r,{...t,salePrice:""});return}let N=parseFloat(o);isNaN(N)||d(r,{...t,salePrice:N})},onBlur:o=>{let N=parseFloat(o.target.value),B=parseFloat(t.price);N&&B&&N>=B&&(wp.data.dispatch("core/notices").createNotice("error",e("Sale price must be less than regular price","digicommerce"),{type:"snackbar"}),d(r,{...t,salePrice:""}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(O,{label:e("Selected by default","digicommerce"),checked:t.isDefault||!1,onChange:o=>d(r,{...t,isDefault:o}),__nextHasNoMarginBottom:!0}),React.createElement(ee,{url:M})),React.createElement("div",{className:"digi-variation-files"},t.files&&t.files.length>0&&React.createElement("p",null,e("Download File:","digicommerce")),t.files&&t.files.map((o,N)=>React.createElement(L,{key:N,className:"digi-card"},React.createElement(R,{className:"digi-card-body"},React.createElement("div",{className:"digi-inputs"},React.createElement(h,{label:e("File Name","digicommerce"),value:o.name,onChange:B=>{let P=[...t.files];P[N]={...o,name:B},d(r,{...t,files:P})},__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("File Path","digicommerce"),value:o.file,disabled:!0,__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Item Name","digicommerce"),value:o.itemName||"",onChange:B=>{let P=[...t.files];P[N]={...o,itemName:B},d(r,{...t,files:P})},placeholder:e("Enter item name","digicommerce"),__nextHasNoMarginBottom:!0})),digicommerceVars.license_enabled&&React.createElement("div",{className:"digi-version-section"},React.createElement(Y,{versions:o.versions||[],onUpdateVersions:B=>A(N,B)})),React.createElement("div",{className:"digi-file-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>m(N)},e("Remove File","digicommerce")))))),React.createElement(y,{variant:"secondary",onClick:c,className:"digi-add-button"},e("Add Download File","digicommerce"))),React.createElement("div",{className:"digi-variation-slots"},React.createElement(X,{name:`DigiCommerceVariablePriceAfter-${r}`,fillProps:{variation:t,index:r,onUpdate:d}})),React.createElement("div",{className:"digi-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>p(r),className:"digi-remove-button"},e("Remove Variation","digicommerce")))))},ge=({file:t,index:r,onUpdate:d,onRemove:p,onDragStart:a,onDragOver:l,onDrop:v,onDragLeave:C,onDragEnd:f})=>{let c=m=>{d(r,{...t,versions:m})};return React.createElement(L,{className:"digi-file-row digi-row",draggable:!0,onDragStart:m=>a(m,r),onDragOver:m=>l(m),onDrop:m=>v(m,r),onDragLeave:m=>C(m),onDragEnd:m=>f(m)},React.createElement(R,null,React.createElement("div",{className:"digi-inputs"},React.createElement(h,{label:e("File Name","digicommerce"),value:t.name,onChange:m=>d(r,{...t,name:m}),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("File Path","digicommerce"),value:t.file,onChange:m=>d(r,{...t,file:m}),disabled:!0,__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Item Name","digicommerce"),value:t.itemName||"",onChange:m=>{let n={...t,itemName:m};d(r,n)},placeholder:e("Enter item name","digicommerce"),__nextHasNoMarginBottom:!0})),digicommerceVars.license_enabled&&React.createElement("div",{className:"digi-version-section"},React.createElement(Y,{versions:t.versions||[],onUpdateVersions:c})),React.createElement("div",{className:"digi-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>p(r)},e("Remove File","digicommerce")))))},ue=({feature:t,index:r,onUpdate:d,onRemove:p,onDragStart:a,onDragOver:l,onDrop:v,onDragLeave:C,onDragEnd:f})=>React.createElement(L,{className:"digi-feature-row digi-row",draggable:!0,onDragStart:c=>a(c,r),onDragOver:c=>l(c),onDrop:c=>v(c,r),onDragLeave:c=>C(c),onDragEnd:c=>f(c)},React.createElement(R,null,React.createElement("div",{className:"digi-inputs"},React.createElement(h,{label:e("Name","digicommerce"),value:t.name,onChange:c=>d(r,{...t,name:c}),placeholder:e("Name","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Text","digicommerce"),value:t.text,onChange:c=>d(r,{...t,text:c}),placeholder:e("Text","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-actions"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>p(r),className:"digi-remove-button"},e("Remove Feature","digicommerce"))))),pe=()=>{let[t,r]=D([]),[d,p]=D([]),a=E(n=>n("core/editor").getCurrentPostId()),{editPost:l}=U("core/editor"),v=E(n=>n("core/editor").getEditedPostAttribute("meta"));x(()=>{wp.apiFetch({path:"/wp/v2/digi_product?per_page=-1",_fields:"id,title,meta"}).then(n=>{let _=n.filter(g=>g.meta?.digi_license_enabled===!0||g.meta?.digi_price_variations&&g.meta.digi_price_variations.some(M=>M.license_enabled));p(_)})},[]),x(()=>{v?.digi_upgrade_paths&&r(v.digi_upgrade_paths)},[v?.digi_upgrade_paths]);let C=()=>{let n={product_id:"",variation_id:"",prorate:!1,include_coupon:!1,discount_type:"fixed",discount_amount:""},_=[...t,n];r(_),l({meta:{digi_upgrade_paths:_}})},f=(n,_,g)=>{let M=[...t];M[n]={...M[n],[_]:g},r(M),l({meta:{digi_upgrade_paths:M}})},c=n=>{let _=t.filter((g,M)=>M!==n);r(_),l({meta:{digi_upgrade_paths:_}})};return!digicommerceVars.pro_active||!digicommerceVars.license_enabled||!(v?.digi_license_enabled||v?.digi_price_variations&&v.digi_price_variations.some(n=>n.license_enabled))?null:React.createElement(S,{title:e("Upgrade Paths","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},t.map((n,_)=>React.createElement(L,{key:_,className:"digi-upgrade-path-card"},React.createElement(R,{className:"digi-inputs"},React.createElement(q,{label:e("Target Product","digicommerce"),value:n.product_id,options:[{label:e("Select a product...","digicommerce"),value:""},...d.map(g=>({label:g.title.rendered,value:g.id.toString()}))],onChange:g=>f(_,"product_id",g),__nextHasNoMarginBottom:!0}),n.product_id&&d.find(g=>g.id===parseInt(n.product_id))?.meta?.digi_price_mode==="variations"&&React.createElement(q,{label:e("Target Variation","digicommerce"),value:n.variation_id,options:[{label:e("Select a variation...","digicommerce"),value:""},...d.find(g=>g.id===parseInt(n.product_id)).meta.digi_price_variations.filter(g=>g.license_enabled).map(g=>({label:g.name,value:g.id}))],onChange:g=>f(_,"variation_id",g),__nextHasNoMarginBottom:!0}),React.createElement(O,{label:e("Prorate","digicommerce"),checked:n.prorate,onChange:g=>f(_,"prorate",g),__nextHasNoMarginBottom:!0}),React.createElement(O,{label:e("Include Coupon","digicommerce"),checked:n.include_coupon,onChange:g=>f(_,"include_coupon",g),__nextHasNoMarginBottom:!0}),n.include_coupon&&React.createElement(React.Fragment,null,React.createElement(q,{label:e("Discount Type","digicommerce"),value:n.discount_type,options:[{label:e("Fixed Amount","digicommerce"),value:"fixed"},{label:e("Percentage","digicommerce"),value:"percentage"}],onChange:g=>f(_,"discount_type",g),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Amount","digicommerce"),type:"number",value:n.discount_amount,onChange:g=>f(_,"discount_amount",g),min:"0",step:n.discount_type==="percentage"?"1":"0.01",__nextHasNoMarginBottom:!0})),React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:()=>c(_),className:"digi-remove-button"},e("Remove Path","digicommerce"))))),React.createElement(y,{variant:"primary",onClick:C,className:"digi-add-button"},e("Add Upgrade Path","digicommerce"))))},ve=({isOpen:t,onClose:r,initialData:d={},onSave:p})=>{let[a,l]=D({homepage:"",author:"",requires:"",requires_php:"",tested:"",description:"",installation:"",upgrade_notice:"",icons:{default:""},banners:{low:"",high:""},contributors:[],...d});x(()=>{t&&l({homepage:"",author:"",requires:"",requires_php:"",tested:"",description:"",installation:"",upgrade_notice:"",icons:{default:""},banners:{low:"",high:""},contributors:[],...d})},[t,d]);let v=()=>{l({...a,contributors:[...a.contributors,{username:"",avatar:"",name:""}]})},C=c=>{let m=[...a.contributors];m.splice(c,1),l({...a,contributors:m})},f=(c,m)=>{let n=[...a.contributors];n[c]=m,l({...a,contributors:n})};return t?React.createElement(K,{title:e("API Data","digicommerce"),onRequestClose:r,className:"digi-api-modal"},React.createElement("div",{className:"digi-api-modal-content"},React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Basic Information","digicommerce")),React.createElement(h,{label:e("Homepage","digicommerce"),type:"url",value:a.homepage,onChange:c=>l({...a,homepage:c}),help:e("Plugin homepage URL.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Author","digicommerce"),value:a.author,onChange:c=>l({...a,author:c}),help:e("Author information with optional link.","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Requirements","digicommerce")),React.createElement(h,{label:e("Requires WordPress Version","digicommerce"),value:a.requires,onChange:c=>l({...a,requires:c}),help:e("Minimum required WordPress version.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Requires PHP Version","digicommerce"),value:a.requires_php,onChange:c=>l({...a,requires_php:c}),help:e("Minimum required PHP version.","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Tested up to","digicommerce"),value:a.tested,onChange:c=>l({...a,tested:c}),help:e("WordPress version the plugin has been tested up to.","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Description & Installation","digicommerce")),React.createElement(H,{label:e("Description","digicommerce"),value:a.description,onChange:c=>l({...a,description:c}),help:e("Full description of the plugin (HTML allowed).","digicommerce"),rows:4,__nextHasNoMarginBottom:!0}),React.createElement(H,{label:e("Installation","digicommerce"),value:a.installation,onChange:c=>l({...a,installation:c}),help:e("Installation instructions (HTML allowed).","digicommerce"),rows:4,__nextHasNoMarginBottom:!0}),React.createElement(H,{label:e("Upgrade Notice","digicommerce"),value:a.upgrade_notice,onChange:c=>l({...a,upgrade_notice:c}),help:e("Upgrade notices for your users.","digicommerce"),rows:2,__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Assets","digicommerce")),React.createElement(h,{label:e("Plugin Icon URL","digicommerce"),type:"url",value:a.icons.default,onChange:c=>l({...a,icons:{default:c}}),help:e("URL to your plugin's icon (256x256px).","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Banner Low Resolution URL","digicommerce"),type:"url",value:a.banners.low,onChange:c=>l({...a,banners:{...a.banners,low:c}}),help:e("URL to your plugin's low resolution banner (772x250px).","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Banner High Resolution URL","digicommerce"),type:"url",value:a.banners.high,onChange:c=>l({...a,banners:{...a.banners,high:c}}),help:e("URL to your plugin's high resolution banner (1544x500px).","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"digi-api-section"},React.createElement("h3",null,e("Contributors","digicommerce")),React.createElement("div",{className:"digi-contributor-wrap"},a.contributors.map((c,m)=>React.createElement("div",{key:m,className:"digi-contributor-row"},React.createElement("div",{className:"digi-contributor-fields"},React.createElement(h,{value:c.username||"",onChange:n=>f(m,{...c,username:n}),placeholder:e("WordPress.org username","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{value:c.name||"",onChange:n=>f(m,{...c,name:n}),placeholder:e("Display Name","digicommerce"),__nextHasNoMarginBottom:!0}),React.createElement(h,{value:c.avatar||"",onChange:n=>f(m,{...c,avatar:n}),type:"url",placeholder:e("Avatar URL","digicommerce"),__nextHasNoMarginBottom:!0})),React.createElement(y,{isDestructive:!0,variant:"secondary",onClick:()=>C(m),icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"},React.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}))}))),React.createElement(y,{variant:"secondary",onClick:()=>v(),className:"digi-add-contributor"},e("Add Contributor","digicommerce")))),React.createElement("div",{className:"digi-api-modal-footer"},React.createElement(y,{variant:"secondary",isDestructive:!0,onClick:r},e("Cancel","digicommerce")),React.createElement(y,{variant:"primary",onClick:()=>p(a)},e("Save","digicommerce"))))):null},he=()=>{let[t,r]=D(!1),{editPost:d}=U("core/editor"),p=E(a=>a("core/editor").getEditedPostAttribute("meta"));return!digicommerceVars.pro_active||!digicommerceVars.license_enabled?null:React.createElement(S,{title:e("API Data","digicommerce"),initialOpen:!1},!p?.digi_api_data||Object.keys(p.digi_api_data).length===0?React.createElement(y,{variant:"primary",onClick:()=>r(!0),className:"digi-add-button"},e("Add API Data","digicommerce")):React.createElement("div",{className:"digi-api-data-preview"},React.createElement(y,{variant:"primary",onClick:()=>r(!0)},e("Edit API Data","digicommerce")),React.createElement("div",{className:"digi-api-data-info"},React.createElement("span",null,React.createElement("strong",null,e("Requires:","digicommerce"))," WordPress ",p.digi_api_data.requires),React.createElement("span",null,React.createElement("strong",null,e("Tested up to:","digicommerce"))," ",p.digi_api_data.tested))),t&&React.createElement(ve,{isOpen:t,onClose:()=>r(!1),initialData:p?.digi_api_data,onSave:a=>{d({meta:{digi_api_data:a}}),r(!1)}}))};ae("digi-product-sidebar",{render:()=>{let[t,r]=D(0),[d,p]=D(""),[a,l]=D([]),[v,C]=D([]),[f,c]=D("single"),[m,n]=D(""),[_,g]=D([]),[M,A]=D(""),{editPost:o}=U("core/editor"),N=E(i=>i("core/editor").getCurrentPostId()),B=digicommerceVars.checkout_page_id||"",P=()=>B?`${wp.url.addQueryArgs(digicommerceVars.checkout_url,{})}`:"",w=E(i=>i("core/editor").getEditedPostAttribute("meta"));x(()=>{w&&(r(w.digi_price||0),p(w.digi_sale_price||""),l(w.digi_files||[]),C(w.digi_price_variations||[]),c(w.digi_price_mode||"single"),n(w.digi_product_description||""),g(w.digi_features||[]),A(w.digi_instructions||""))},[w]);let V=()=>{let i=document.createElement("input");i.type="file",i.multiple=!1,i.addEventListener("change",async s=>{let u=s.target.files[0];if(!u)return;let b=new FormData;b.append("action","digicommerce_upload_file"),b.append("file",u),b.append("upload_nonce",digicommerceVars.upload_nonce);try{digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("info",digicommerceVars.i18n.s3_uploading,{type:"snackbar",isDismissible:!1}):wp.data.dispatch("core/notices").createNotice("info",e("Uploading file...","digicommerce"),{type:"snackbar",isDismissible:!1});let F=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:b})).json();if(F.success){let T={name:F.data.name,file:F.data.file,id:F.data.id,type:F.data.type,size:F.data.size,itemName:J(F.data.name)},I=[...a,T];l(I),o({meta:{digi_files:I}}),digicommerceVars.s3_enabled?wp.data.dispatch("core/notices").createNotice("success",e("File successfully uploaded to Amazon S3","digicommerce"),{type:"snackbar"}):wp.data.dispatch("core/notices").createNotice("success",e("File uploaded successfully","digicommerce"),{type:"snackbar"})}else if(F.data?.s3_error)wp.data.dispatch("core/notices").createNotice("error",digicommerceVars.i18n.s3_upload_failed,{type:"snackbar"});else throw new Error(F.data||"Upload failed")}catch(k){console.error("Upload error:",k),wp.data.dispatch("core/notices").createNotice("error",e("Upload failed. Please try again.","digicommerce"),{type:"snackbar"})}}),i.click()},z=(i,s)=>{let u=[...a];u[i]=s,l(u),o({meta:{digi_files:u}})},W=i=>{let s=a[i],u=a.filter((b,k)=>k!==i);l(u),o({meta:{digi_files:u}}),wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:s,is_s3:s.s3||!1}}).then(b=>{if(b.success){let k=b.message;b.status==="not_found"&&(k=digicommerceVars.s3_enabled?e("File removed from product (was already deleted from S3)","digicommerce"):e("File removed from product (was already deleted from server)","digicommerce")),wp.data.dispatch("core/notices").createNotice("success",k,{type:"snackbar"})}}).catch(b=>{console.error("Error deleting file:",b),l([...a]),o({meta:{digi_files:[...a]}}),wp.data.dispatch("core/notices").createNotice("error",b.message||e("Failed to delete file. Please try again.","digicommerce"),{type:"snackbar"})})},ie=i=>{c(i),o({meta:{digi_price_mode:i}})},_e=()=>{let s={id:Date.now().toString()+Math.random().toString(36).substr(2,5),name:"",price:0,salePrice:null,files:[],subscription_enabled:!1,subscription_period:"month",subscription_free_trial:{duration:0,period:"days"},subscription_signup_fee:0},u=[...v,s];C(u),o({meta:{digi_price_variations:u}})},fe=(i,s)=>{let u=[...v];u[i]=s,C(u),o({meta:{digi_price_variations:u}})},be=async i=>{let s=v[i];if(s.files&&s.files.length>0)for(let b of s.files)try{await wp.apiFetch({path:"/wp/v2/digicommerce/delete-file",method:"POST",data:{file:b,is_s3:b.s3||!1}})}catch(k){console.error("Error deleting variation file:",k),wp.data.dispatch("core/notices").createNotice("error",e("Error deleting some files, but variation was removed","digicommerce"),{type:"snackbar"})}let u=v.filter((b,k)=>k!==i);C(u),o({meta:{digi_price_variations:u}}),wp.data.dispatch("core/notices").createNotice("success",digicommerceVars.s3_enabled?e("Variation and associated S3 files removed successfully","digicommerce"):e("Variation removed successfully","digicommerce"),{type:"snackbar"})},ye=()=>{let i={name:"",text:""},s=[..._,i];g(s),o({meta:{digi_features:s}})},Ne=(i,s)=>{let u=[..._];u[i]=s,g(u),o({meta:{digi_features:u}})},we=i=>{let s=_.filter((u,b)=>b!==i);g(s),o({meta:{digi_features:s}})},G=(i,s)=>{i.dataTransfer.setData("text/plain",s),i.currentTarget.classList.add("is-dragging")},j=i=>{i.preventDefault(),i.currentTarget.classList.add("is-drag-over")},$=i=>{i.currentTarget.classList.remove("is-drag-over"),i.currentTarget.classList.remove("is-dragging")},Q=i=>{i.currentTarget.classList.remove("is-dragging"),i.currentTarget.classList.remove("is-drag-over"),document.querySelectorAll(".digi-file-row, .digi-variation-row, .digi-feature-row").forEach(s=>{s.classList.remove("is-drag-over"),s.classList.remove("is-dragging")})},Z=(i,s,u,b,k)=>{i.preventDefault(),i.currentTarget.classList.remove("is-drag-over"),i.currentTarget.classList.remove("is-dragging");let F=parseInt(i.dataTransfer.getData("text/plain"));if(F===s)return;let T=[...u],[I]=T.splice(F,1);T.splice(s,0,I),b(T),o({meta:{[k]:T}}),document.querySelectorAll(".digi-file-row, .digi-variation-row, .digi-feature-row").forEach(te=>{te.classList.remove("is-drag-over"),te.classList.remove("is-dragging")})},Ce=(i,s)=>Z(i,s,a,l,"digi_files"),Pe=(i,s)=>Z(i,s,v,C,"digi_price_variations"),Be=(i,s)=>Z(i,s,_,g,"digi_features");return React.createElement(React.Fragment,null,React.createElement(oe,{target:"product-details"},e("Product Details","digicommerce")),React.createElement(re,{name:"product-details",title:e("Product Details","digicommerce"),className:"digi-product-sidebar"},React.createElement(S,{title:e("Pricing","digicommerce"),initialOpen:!0},React.createElement("div",{className:"digi-price-mode-toggle"},React.createElement(ne,{className:"digi-price-mode-buttons"},React.createElement(y,{variant:f==="single"?"primary":"secondary",onClick:()=>ie("single"),className:"digi-price-mode-button"},e("Single Price","digicommerce")),React.createElement(y,{variant:f==="variations"?"primary":"secondary",onClick:()=>ie("variations"),className:"digi-price-mode-button"},e("Price Variations","digicommerce")))),f==="single"?React.createElement("div",{className:"digi-inputs"},React.createElement(h,{label:e("Regular Price","digicommerce"),value:t,onChange:i=>{if(i===""){r("");return}let s=parseFloat(i);isNaN(s)||(r(s),o({meta:{digi_price:s}}),d&&parseFloat(d)>=s&&(p(""),o({meta:{digi_sale_price:""}})))},onBlur:()=>{let i=parseFloat(t)||0;r(i),o({meta:{digi_price:i}})},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(h,{label:e("Sale Price","digicommerce"),value:d,onChange:i=>{if(i===""){p(""),o({meta:{digi_sale_price:""}});return}let s=parseFloat(i);isNaN(s)||(p(s),o({meta:{digi_sale_price:s}}))},onBlur:i=>{let s=parseFloat(i.target.value),u=parseFloat(t);s&&u&&s>=u&&(wp.data.dispatch("core/notices").createNotice("error",e("Sale price must be less than regular price","digicommerce"),{type:"snackbar"}),p(""),o({meta:{digi_sale_price:""}}))},type:"number",step:"1",min:"0",inputMode:"decimal",__nextHasNoMarginBottom:!0}),React.createElement(ee,{url:wp.url.addQueryArgs(P(),{id:N})}),React.createElement("div",{className:"digi-slot-container"},React.createElement(X,{name:"DigiCommerceSinglePriceAfter"}))):React.createElement("div",{className:"digi-variations-section"},React.createElement("div",{className:"digi-container"},v.map((i,s)=>React.createElement(me,{key:s,variation:i,index:s,onUpdate:fe,onRemove:be,onDragStart:G,onDragOver:j,onDrop:Pe,onDragLeave:$,onDragEnd:Q}))),React.createElement(y,{variant:"primary",onClick:_e,className:"digi-add-button"},e("Add Price Variation","digicommerce")))),React.createElement(S,{title:e("Downloadable Files","digicommerce"),initialOpen:!1},a.length>0&&React.createElement("div",{style:{display:"flex",backgroundColor:"#f6f7f9",borderRadius:"0.75rem",fontSize:"0.7rem",marginBottom:"1.5rem",padding:"1rem",alignItems:"center"}},digicommerceVars.s3_enabled?e("NOTE: When a file is removed, it is completely removed from your S3 bucket.","digicommerce"):e("NOTE: When a file is removed, it is completely removed from your server.","digicommerce")),React.createElement("div",{className:"digi-container"},a.map((i,s)=>React.createElement(ge,{key:s,file:i,index:s,onUpdate:z,onRemove:W,onDragStart:G,onDragOver:j,onDrop:Ce,onDragLeave:$,onDragEnd:Q}))),React.createElement(y,{variant:"primary",onClick:V,className:"digi-add-button"},e("Add New File","digicommerce"))),React.createElement(S,{title:e("Description","digicommerce"),initialOpen:!1},React.createElement(H,{help:e("Add a detailed description for your product.","digicommerce"),value:m,onChange:i=>{n(i),o({meta:{digi_product_description:i}})},rows:4,__nextHasNoMarginBottom:!0})),React.createElement(S,{title:e("Gallery","digicommerce"),initialOpen:!1},React.createElement(ce,null,React.createElement(se,{onSelect:i=>{let s=i.map(u=>({id:u.id,url:u.sizes?.medium?.url||u.url,alt:u.alt||""}));o({meta:{digi_gallery:s}})},allowedTypes:["image"],multiple:!0,gallery:!0,value:w?.digi_gallery?.map(i=>i.id)||[],render:({open:i})=>React.createElement("div",null,React.createElement("div",{className:"digi-gallery-grid"},(w?.digi_gallery||[]).map((s,u)=>React.createElement("div",{key:u,className:"digi-gallery-item",onClick:i,role:"button",tabIndex:0,onKeyDown:b=>{(b.key==="Enter"||b.key===" ")&&i()}},React.createElement("img",{src:s.url,alt:s.alt,className:"digi-gallery-image"}),React.createElement("button",{type:"button",onClick:b=>{b.stopPropagation();let k=[...w.digi_gallery||[]];k.splice(u,1),o({meta:{digi_gallery:k}})},className:"digi-remove-gallery-image"},React.createElement("span",{className:"sr-only"},e("Remove image","digicommerce")),React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2"},React.createElement("path",{d:"M18 6L6 18M6 6l12 12"})))))),React.createElement(y,{variant:"primary",onClick:i,className:"digi-add-button"},w?.digi_gallery?.length?e("Edit Gallery","digicommerce"):e("Add Gallery Images","digicommerce")))}))),React.createElement(S,{title:e("Features","digicommerce"),initialOpen:!1},React.createElement("div",{className:"digi-container"},_.map((i,s)=>React.createElement(ue,{key:s,feature:i,index:s,onUpdate:Ne,onRemove:we,onDragStart:G,onDragOver:j,onDrop:Be,onDragLeave:$,onDragEnd:Q}))),React.createElement(y,{variant:"primary",onClick:ye,className:"digi-add-button"},e("Add Feature","digicommerce"))),React.createElement(S,{title:e("Download Instructions","digicommerce"),initialOpen:!1},React.createElement(H,{label:e("Instructions for customers","digicommerce"),help:e("These instructions will be shown to customers after purchase","digicommerce"),value:M,onChange:i=>{A(i),o({meta:{digi_instructions:i}})},rows:4,__nextHasNoMarginBottom:!0})),React.createElement(pe,null),React.createElement(he,null)))},icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"24",height:"24",fill:"currentColor",className:"digi__icon"},React.createElement("circle",{cx:"256",cy:"256",r:"256"}),React.createElement("path",{d:"M361.4858,348.7728c4.6805,0,8.9099,1.8997,11.9904,4.96,3.1729,3.177,4.952,7.4854,4.9451,11.9755,0,4.672-1.8912,8.9099-4.9451,11.9701-3.1801,3.1788-7.494,4.9621-11.9904,4.9568-4.4924.0071-8.8023-1.7768-11.9755-4.9568-3.1781-3.1723-4.9618-7.4797-4.9568-11.9701,0-4.6805,1.8965-8.9099,4.9568-11.9755,3.1739-3.1794,7.483-4.9641,11.9755-4.96h0ZM199.2159,348.7728c4.6795,0,8.9152,1.8997,11.9755,4.96,3.1815,3.1724,4.9663,7.4826,4.9589,11.9755,0,4.672-1.8933,8.9099-4.9589,11.9701-3.1722,3.1815-7.4827,4.9657-11.9755,4.9568-4.491.0081-8.7996-1.7761-11.9701-4.9568-3.1808-3.1707-4.9656-7.479-4.9589-11.9701,0-4.6805,1.8933-8.9099,4.9589-11.9755,3.1712-3.1801,7.4791-4.9652,11.9701-4.96h0ZM145.0057,129.3637l8.0203,33.6693h-43.2928c-3.9738,0-7.1952,3.2214-7.1952,7.1952s3.2214,7.1952,7.1952,7.1952h100.7712c3.9729,0,7.1936,3.2207,7.1936,7.1936s-3.2207,7.1936-7.1936,7.1936h-50.6219l2.4341,10.2304h-9.0208c-3.9738,0-7.1952,3.2214-7.1952,7.1952s3.2214,7.1952,7.1952,7.1952h64.6784c3.9738.0484,7.1559,3.3091,7.1075,7.2829-.0476,3.9055-3.202,7.0599-7.1075,7.1075h-48.8075l2.528,10.6197h-57.4848c-3.9712,0-7.1904,3.2203-7.1904,7.1936s3.2203,7.1936,7.1904,7.1936h113.7248c3.9738.0481,7.1562,3.3084,7.1082,7.2822-.0472,3.906-3.2022,7.0609-7.1082,7.1082h-49.3802l2.6699,11.2192c-6.3669.7413-12.0949,3.6533-16.4149,7.9669-5.0325,5.0379-8.1557,11.9872-8.1557,19.6373s3.1243,14.6027,8.1557,19.6352c5.0379,5.0411,11.9872,8.1621,19.6437,8.1621h2.5835c-3.7221,1.5774-7.1056,3.8568-9.9659,6.7136-5.8861,5.8685-9.1892,13.8418-9.1776,22.1536,0,8.6475,3.5051,16.4757,9.1776,22.1451,5.6693,5.6693,13.5029,9.1744,22.1451,9.1744,8.6475,0,16.4843-3.5051,22.1536-9.1744,5.6693-5.6693,9.1744-13.4976,9.1744-22.1451.0113-8.3111-3.2904-16.2839-9.1744-22.1536-2.8615-2.8568-6.2461-5.1361-9.9691-6.7136h137.8997c-3.7203,1.5773-7.1018,3.8567-9.9595,6.7136-5.6693,5.6693-9.1776,13.5029-9.1776,22.1536s3.5083,16.4757,9.1776,22.1451c5.6693,5.6693,13.4965,9.1744,22.1451,9.1744s16.4693-3.5051,22.1419-9.1744c5.6725-5.6693,9.1915-13.4976,9.1915-22.1451s-3.52-16.4843-9.1915-22.1536c-2.8512-2.8593-6.2294-5.1392-9.9477-6.7136h10.2677c3.9563,0,7.1851-3.2203,7.1851-7.1968s-3.2288-7.1968-7.1851-7.1968h-199.4944c-3.68,0-7.0304-1.5093-9.4688-3.9381-2.4288-2.4352-3.9445-5.7803-3.9445-9.4656,0-3.68,1.5157-7.0251,3.9445-9.4592,2.4373-2.4288,5.7888-3.9445,9.4688-3.9445h175.072c5.8261,0,11.2224-1.9488,15.5211-5.3291,4.2763-3.3653,7.4464-8.1472,8.8427-13.8368l25.3365-103.9563c.2353-.739.353-1.5104.3488-2.2859,0-3.9733-3.2-7.1968-7.1851-7.1968h-234.5749l-10.0736-42.2912c-.6792-3.3563-3.6295-5.7691-7.0539-5.7685h-30.1205c-3.9735-.0012-7.1956,3.219-7.1968,7.1925v.0043c0,3.9729,3.2207,7.1936,7.1936,7.1936h24.4427v-.0011Z",fill:"#fff"}))})})();})();
