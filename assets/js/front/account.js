(()=>{document.addEventListener("DOMContentLoaded",()=>{let s=document.getElementById("digicommerce-login-form"),i=document.getElementById("digicommerce-register-form"),c=document.getElementById("digicommerce-lost-password-form"),f=document.getElementById("show-login"),L=document.getElementById("show-register"),p=document.getElementById("show-lost-password"),w=document.getElementById("back-to-login"),l=document.getElementById("login-message"),m=document.getElementById("register-message"),g=document.getElementById("lost-password-message"),y=document.querySelectorAll(".pass__icon");y&&y.forEach(e=>{let t=e.parentElement.querySelector("input"),d=e.querySelector("[data-show]"),o=e.querySelector("[data-hide]");e.addEventListener("click",n=>{n.preventDefault(),t.type==="password"?(t.type="text",d.classList.remove("hidden"),o.classList.add("hidden")):(t.type="password",d.classList.add("hidden"),o.classList.remove("hidden"))})}),L&&i&&L?.addEventListener("click",e=>{e.preventDefault(),s.classList.add("hidden"),i.classList.remove("hidden"),l.classList.add("hidden"),m.classList.add("hidden")}),f&&f?.addEventListener("click",e=>{e.preventDefault(),i.classList.add("hidden"),s.classList.remove("hidden"),l.classList.add("hidden"),m.classList.add("hidden")}),p&&p?.addEventListener("click",e=>{e.preventDefault(),s.classList.add("hidden"),c.classList.remove("hidden"),l.classList.add("hidden"),g.classList.add("hidden")}),w&&w?.addEventListener("click",e=>{e.preventDefault(),c.classList.add("hidden"),s.classList.remove("hidden"),l.classList.add("hidden"),g.classList.add("hidden")});let v=(e,t,d=!0)=>{e.textContent=t,e.classList.remove("hidden"),e.classList.remove("bg-green-500","bg-red-500"),e.classList.add(d?"bg-red-500":"bg-green-500")},u=async(e,t,d)=>{let o=e.querySelector('button[type="submit"]'),n=o.querySelector(".text"),B=n.textContent;try{o.disabled=!0,t==="login"?n.textContent=digicommerceVars.i18n.logging_in:t==="register"?n.textContent=digicommerceVars.i18n.registering_in:t==="lost_password"&&(n.textContent=digicommerceVars.i18n.sending_email);let a=new FormData(e);a.append("action",`digicommerce_${t}`);let _=e.querySelector(`input[name="digicommerce_${t}_nonce"]`);if(!_)throw console.error(`Nonce field not found: digicommerce_${t}_nonce`),new Error("Security token missing");if(a.append("nonce",_.value),digicommerceVars.recaptcha_site_key)try{let h=await grecaptcha.execute(digicommerceVars.recaptcha_site_key,{action:t});a.append("recaptcha_token",h)}catch(h){console.error("reCAPTCHA error:",h)}let r=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",credentials:"same-origin",body:a})).json();if(r.success)v(d,r.data.message,!1),r.data.redirect_url&&setTimeout(()=>{window.location.href=r.data.redirect_url},1e3);else throw new Error(r.data?r.data.message:digicommerceVars.i18n.error)}catch(a){v(d,a.message),t==="login"&&(e.querySelector("#password").value="")}finally{o.disabled=!1,n.textContent=B}};s&&s?.addEventListener("submit",async e=>{e.preventDefault(),await u(s,"login",l)}),i&&i?.addEventListener("submit",async e=>{e.preventDefault(),await u(i,"register",m)}),c&&c?.addEventListener("submit",async e=>{e.preventDefault(),await u(c,"lost_password",g)});let E=document.querySelectorAll(".digi__form .field input");E&&E.forEach(e=>{let t=()=>{e.value!==""?e.classList.add("focused"):e.classList.remove("focused")};t(),e.addEventListener("blur",t),e.addEventListener("input",t)})});})();
