(()=>{document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("digicommerce-login-form"),d=document.getElementById("digicommerce-register-form"),n=document.getElementById("digicommerce-lost-password-form"),L=document.getElementById("show-login"),f=document.getElementById("show-register"),p=document.getElementById("show-lost-password"),w=document.getElementById("back-to-login"),l=document.getElementById("login-message"),m=document.getElementById("register-message"),g=document.getElementById("lost-password-message"),y=new URLSearchParams(window.location.search).get("action");y==="lostpassword"&&n?(t?.classList.add("hidden"),d?.classList.add("hidden"),n.classList.remove("hidden")):y==="register"&&d&&(t?.classList.add("hidden"),n?.classList.add("hidden"),d.classList.remove("hidden"));let v=document.querySelectorAll(".pass__icon");v&&v.forEach(e=>{let s=e.parentElement.querySelector("input"),i=e.querySelector("[data-show]"),o=e.querySelector("[data-hide]");e.addEventListener("click",a=>{a.preventDefault(),s.type==="password"?(s.type="text",i.classList.remove("hidden"),o.classList.add("hidden")):(s.type="password",i.classList.add("hidden"),o.classList.remove("hidden"))})}),f&&d&&f?.addEventListener("click",e=>{e.preventDefault(),t.classList.add("hidden"),d.classList.remove("hidden"),l.classList.add("hidden"),m.classList.add("hidden")}),L&&L?.addEventListener("click",e=>{e.preventDefault(),d.classList.add("hidden"),t.classList.remove("hidden"),l.classList.add("hidden"),m.classList.add("hidden")}),p&&p?.addEventListener("click",e=>{e.preventDefault(),t.classList.add("hidden"),n.classList.remove("hidden"),l.classList.add("hidden"),g.classList.add("hidden")}),w&&w?.addEventListener("click",e=>{e.preventDefault(),n.classList.add("hidden"),t.classList.remove("hidden"),l.classList.add("hidden"),g.classList.add("hidden")});let E=(e,s,i=!0)=>{e.textContent=s,e.classList.remove("hidden"),e.classList.remove("bg-green-500","bg-red-500"),e.classList.add(i?"bg-red-500":"bg-green-500")},u=async(e,s,i)=>{let o=e.querySelector('button[type="submit"]'),a=o.querySelector(".text"),b=a.textContent;try{o.disabled=!0,s==="login"?a.textContent=digicommerceVars.i18n.logging_in:s==="register"?a.textContent=digicommerceVars.i18n.registering_in:s==="lost_password"&&(a.textContent=digicommerceVars.i18n.sending_email);let r=new FormData(e);r.append("action",`digicommerce_${s}`);let B=e.querySelector(`input[name="digicommerce_${s}_nonce"]`);if(!B)throw console.error(`Nonce field not found: digicommerce_${s}_nonce`),new Error("Security token missing");if(r.append("nonce",B.value),digicommerceVars.recaptcha_site_key)try{let h=await grecaptcha.execute(digicommerceVars.recaptcha_site_key,{action:s});r.append("recaptcha_token",h)}catch(h){console.error("reCAPTCHA error:",h)}let c=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",credentials:"same-origin",body:r})).json();if(c.success)E(i,c.data.message,!1),c.data.redirect_url&&setTimeout(()=>{window.location.href=c.data.redirect_url},1e3);else throw new Error(c.data?c.data.message:digicommerceVars.i18n.error)}catch(r){E(i,r.message),s==="login"&&(e.querySelector("#password").value="")}finally{o.disabled=!1,a.textContent=b}};t&&t?.addEventListener("submit",async e=>{e.preventDefault(),await u(t,"login",l)}),d&&d?.addEventListener("submit",async e=>{e.preventDefault(),await u(d,"register",m)}),n&&n?.addEventListener("submit",async e=>{e.preventDefault(),await u(n,"lost_password",g)});let _=document.querySelectorAll(".digi__form .field input");_&&_.forEach(e=>{let s=()=>{e.value!==""?e.classList.add("focused"):e.classList.remove("focused")};s(),e.addEventListener("blur",s),e.addEventListener("input",s)})});})();
