(()=>{document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("digicommerce-login-checkout"),d=document.querySelector(".login-checkout-link"),l=document.querySelectorAll(".pass__icon");l&&l.forEach(t=>{let s=t.parentElement.querySelector("input"),o=t.querySelector("[data-show]"),c=t.querySelector("[data-hide]");t.addEventListener("click",a=>{a.preventDefault(),s.type==="password"?(s.type="text",o.classList.remove("hidden"),c.classList.add("hidden")):(s.type="password",o.classList.add("hidden"),c.classList.remove("hidden"))})});let m=(t,s,o=!0)=>{t.textContent=s,t.classList.remove("hidden"),t.classList.remove("bg-green-500","bg-red-500"),t.classList.add(o?"bg-red-500":"bg-green-500")};if(e&&d){e.style.cssText=`
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        `;let t=!1;d.addEventListener("click",function(s){if(s.preventDefault(),t){let o=e.scrollHeight;e.style.maxHeight=`${o}px`,e.style.opacity="1",requestAnimationFrame(()=>{e.style.maxHeight="0",e.style.opacity="0"}),setTimeout(()=>{e.classList.remove("flex"),e.classList.add("hidden")},300)}else{e.classList.remove("hidden"),e.classList.add("flex");let o=e.scrollHeight;e.style.maxHeight=`${o}px`,e.style.opacity="1",setTimeout(()=>{e.style.maxHeight="none"},300)}t=!t})}e&&e.addEventListener("submit",async t=>{t.preventDefault();let s=e.querySelector('button[type="submit"]'),o=s.querySelector(".text"),c=o.textContent,a=document.getElementById("login-message");try{s.disabled=!0,o.textContent=digicommerceVars.i18n.logging_in;let i=new FormData(e);i.append("action","digicommerce_login_checkout");let g=e.querySelector('input[name="digicommerce_login_checkout_nonce"]');if(!g)throw console.error("Nonce field not found: digicommerce_login_checkout_nonce"),new Error("Security token missing");if(i.append("nonce",g.value),digicommerceVars.recaptcha_site_key)try{let r=await grecaptcha.execute(digicommerceVars.recaptcha_site_key,{action:"login"});i.append("recaptcha_token",r)}catch(r){console.error("reCAPTCHA error:",r)}let n=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",credentials:"same-origin",body:i})).json();if(n.success)m(a,n.data.message,!1),n.data.redirect_url&&setTimeout(()=>{window.location.href=n.data.redirect_url},1e3);else throw new Error(n.data?n.data.message:digicommerceVars.i18n.error)}catch(i){m(a,i.message),this.querySelector("#password").value=""}finally{s.disabled=!1,o.textContent=c}})});})();
