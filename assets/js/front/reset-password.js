(()=>{document.addEventListener("DOMContentLoaded",()=>{let o=document.getElementById("digicommerce-reset-password-form");if(!o)return;let i=document.getElementById("reset-password-message"),d=document.getElementById("password"),c=document.querySelector(".password-strength-meter-bar"),l=document.querySelector(".password-strength-text"),w={length:{regex:/.{8,}/,element:document.querySelector('[data-requirement="length"]')},uppercase:{regex:/[A-Z]/,element:document.querySelector('[data-requirement="uppercase"]')},lowercase:{regex:/[a-z]/,element:document.querySelector('[data-requirement="lowercase"]')},number:{regex:/[0-9]/,element:document.querySelector('[data-requirement="number"]')},special:{regex:/[^A-Za-z0-9]/,element:document.querySelector('[data-requirement="special"]')}},p=a=>{let e=!0,s=0,h=Object.keys(w).length;Object.entries(w).forEach(([u,{regex:r,element:n}])=>{let g=r.test(a);if(e=e&&g,g&&s++,n){let y=n.querySelector("svg");g?(n.classList.remove("text-gray-500"),n.classList.add("text-green-500"),y.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />'):(n.classList.remove("text-green-500"),n.classList.add("text-gray-500"),y.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />')}});let t=document.querySelector(".password-strength");return t.classList.remove("weak","medium","strong"),s<2?(t.classList.add("weak"),l.textContent="Faible",c.style.width="33%"):e?(t.classList.add("strong"),l.textContent="Fort",c.style.width="100%"):(t.classList.add("medium"),l.textContent="Moyen",c.style.width="66%"),e};d.addEventListener("input",()=>{p(d.value)});let m=(a,e=!0)=>{i.textContent=a,i.classList.remove("hidden","bg-green-500","bg-red-500"),i.classList.add(e?"bg-red-500":"bg-green-500")};o.addEventListener("submit",async a=>{if(a.preventDefault(),!p(d.value)){m(digicommerceVars.i18n.password_requirements);return}let e=o.querySelector(".digi__button"),s=e.querySelector(".text"),h=s.textContent;try{e.disabled=!0,s.textContent=digicommerceVars.i18n.resetting;let t=new FormData(o);t.append("action","digicommerce_reset_password"),t.append("nonce",o.querySelector("#digicommerce_reset_password_nonce").value);let u=await fetch(digicommerceVars.ajaxurl,{method:"POST",credentials:"same-origin",body:t});if(!u.ok)throw new Error(digicommerceVars.i18n.server_error);let r=await u.json();if(r.success)m(r.data.message,!1),r.data.redirect_url&&setTimeout(()=>{window.location.href=r.data.redirect_url},2e3);else throw new Error(r.data.message||digicommerceVars.i18n.unknown_error)}catch(t){m(t.message),e.disabled=!1,s.textContent=h}})});})();
