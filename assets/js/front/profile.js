(()=>{document.addEventListener("DOMContentLoaded",()=>{let m=document.getElementById("digicommerce-profile-form"),c=document.getElementById("digicommerce-password-form"),b=document.getElementById("profile-message"),f=document.getElementById("password-message"),L=document.querySelectorAll(".pass__icon");L&&L.forEach(e=>{let t=e.parentElement.querySelector("input"),r=e.querySelector("[data-show]"),o=e.querySelector("[data-hide]");e.addEventListener("click",s=>{s.preventDefault(),t.type==="password"?(t.type="text",r.classList.remove("hidden"),o.classList.add("hidden")):(t.type="password",r.classList.add("hidden"),o.classList.remove("hidden"))})});let g=document.getElementById("new_password"),d=document.querySelector(".password-strength-meter-bar"),l=document.querySelector(".password-strength-text"),p={length:{regex:/.{8,}/,element:document.querySelector('[data-requirement="length"]')},uppercase:{regex:/[A-Z]/,element:document.querySelector('[data-requirement="uppercase"]')},lowercase:{regex:/[a-z]/,element:document.querySelector('[data-requirement="lowercase"]')},number:{regex:/[0-9]/,element:document.querySelector('[data-requirement="number"]')},special:{regex:/[^A-Za-z0-9]/,element:document.querySelector('[data-requirement="special"]')}},v=e=>{let t=!0,r=0,o=Object.keys(p).length;Object.entries(p).forEach(([S,{regex:i,element:n}])=>{let a=i.test(e);if(t=t&&a,a&&r++,n){let y=n.querySelector("svg");a?(n.classList.remove("text-gray-500"),n.classList.add("text-green-500"),y.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />'):(n.classList.remove("text-green-500"),n.classList.add("text-gray-500"),y.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />')}});let s=document.querySelector(".password-strength");return s.classList.remove("weak","medium","strong"),r<2?(s.classList.add("weak"),l.textContent="Faible",d.style.width="33%"):t?(s.classList.add("strong"),l.textContent="Fort",d.style.width="100%"):(s.classList.add("medium"),l.textContent="Moyen",d.style.width="66%"),t};g&&g.addEventListener("input",()=>{v(g.value)});let h=(e,t,r=!0)=>{e.textContent=t,e.classList.remove("hidden","bg-green-500","bg-red-500"),e.classList.add(r?"bg-red-500":"bg-green-500","text-white");let s=e.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:s,behavior:"smooth"})},q=async(e,t,r)=>{let o=e.querySelector('button[type="submit"]'),s=o.querySelector(".text"),S=o.textContent;o.disabled=!0,s.textContent=t==="update_profile"?digicommerceVars.i18n.saving:digicommerceVars.i18n.updating;try{let i=new FormData(e);i.append("action",`digicommerce_${t}`),i.append("nonce",e.querySelector(`#digicommerce_${t}_nonce`).value);let n=await fetch(digicommerceVars.ajaxurl,{method:"POST",credentials:"same-origin",body:i});if(!n.ok)throw new Error(digicommerceVars.i18n.server_error);let a=await n.json();if(a.success)h(r,a.data.message,!1),t==="change_password"&&(e.querySelector("#current_password").value="",e.querySelector("#new_password").value="",document.querySelector(".password-strength").classList.remove("weak","medium","strong"),l.textContent="",d.style.width="0%",Object.values(p).forEach(({element:u})=>{if(u){let _=u.querySelector("svg");u.classList.remove("text-green-500"),u.classList.add("text-gray-500"),_.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />'}})),a.data.redirect_url&&setTimeout(()=>{window.location.href=a.data.redirect_url},1500);else throw new Error(a.data.message||digicommerceVars.i18n.unknown_error)}catch(i){console.error("Form submission error:",i),h(r,i.message)}finally{o.disabled=!1,s.textContent=S}};m&&m?.addEventListener("submit",async e=>{e.preventDefault(),await q(m,"update_profile",b)}),c&&c?.addEventListener("submit",async e=>{e.preventDefault();let t=c.querySelector("#new_password").value;if(!v(t)){h(f,digicommerceVars.i18n.password_requirements);return}await q(c,"change_password",f)});let w=document.getElementById("billing_country");if(w){let e=new Choices(w,{searchEnabled:!0,searchPlaceholderValue:w.dataset.placeholder,searchResultLimit:-1})}let x=document.querySelectorAll(".digi__form .field input");x&&x.forEach(e=>{let t=()=>{e.value!==""?e.classList.add("focused"):e.classList.remove("focused")};t(),e.addEventListener("blur",t),e.addEventListener("input",t)})});})();
