(()=>{document.addEventListener("DOMContentLoaded",function(){document.addEventListener("digicommerce_cart_updated",function(o){o.detail&&o.detail.source!=="checkout_page"&&setTimeout(()=>{window.location.reload()},200)});let r=document.querySelectorAll(".remove-item-btn");r&&r.forEach(o=>{o.addEventListener("click",async function(n){n.preventDefault();let a=this.dataset.index;try{let t=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:new URLSearchParams({action:"digicommerce_remove_cart_item",index:a,nonce:digicommerceVars.order_nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if(t.success&&t.data){if(this.closest(".cart-item").remove(),document.querySelectorAll(".remove-item-btn").forEach((e,m)=>{e.dataset.index=m}),document.querySelectorAll(".cart-item").length){let e=document.getElementById("cart-subtotal");e&&(e.innerHTML=t.data.formatted_prices.subtotal),window.vatCalculator&&window.vatCalculator.updateFromSubtotal()}else{let e=document.querySelector(".digicommerce-checkout");e&&digicommerceVars.empty_cart_template&&(e.innerHTML=digicommerceVars.empty_cart_template)}let i=new CustomEvent("digicommerce_cart_updated",{detail:{source:"checkout_page",action:"remove",itemIndex:a,data:t.data}});document.dispatchEvent(i);let d=new CustomEvent("digicommerce_removed_from_cart",{detail:{source:"checkout_page",itemIndex:a,data:t.data}});if(document.dispatchEvent(d),digicommerceVars.proVersion&&digicommerceVars.enableSideCart){let e=new CustomEvent("digicommerce_cart_updated");document.dispatchEvent(e)}}else console.error("Remove cart item failed:",t),alert(t.data?.message||"Failed to remove item.")}catch(c){console.error("Cart removal error:",c),alert("An error occurred. Please try again.")}})})});})();
