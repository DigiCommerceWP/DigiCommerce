(()=>{document.addEventListener("DOMContentLoaded",function(){document.addEventListener("digicommerce_cart_updated",function(o){o.detail&&o.detail.source!=="checkout_page"&&setTimeout(()=>{window.location.reload()},200)});function s(){let o=document.getElementById("payment_method_paypal");return o&&o.checked}let r=document.querySelectorAll(".remove-item-btn");r&&r.forEach(o=>{o.addEventListener("click",async function(l){l.preventDefault();let c=this.dataset.index;try{let a=document.getElementById("country"),i=document.getElementById("vat_number"),u=a?a.value:"",p=i?i.value:"",e=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:new URLSearchParams({action:"digicommerce_remove_cart_item",index:c,nonce:digicommerceVars.order_nonce,country:u,vat_number:p}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if(e.success&&e.data){if(s()){window.location.href=window.location.pathname;return}if(this.closest(".cart-item").remove(),document.querySelectorAll(".remove-item-btn").forEach((t,d)=>{t.dataset.index=d}),document.querySelectorAll(".cart-item").length){let t=document.getElementById("cart-subtotal");if(t&&(t.innerHTML=e.data.formatted_prices.subtotal),digicommerceVars.removeTaxes){let n=document.getElementById("cart-total");if(n){let m=n.querySelector(".total-price .price");m&&(m.textContent=e.data.raw_values.total.toFixed(2)),n.dataset.currentTotal=e.data.raw_values.total}}else window.vatCalculator&&window.vatCalculator.updateFromSubtotal()}else{let t=document.querySelector(".digicommerce-checkout");t&&digicommerceVars.empty_cart_template&&(t.innerHTML=digicommerceVars.empty_cart_template)}let v=new CustomEvent("digicommerce_cart_updated",{detail:{source:"checkout_page",action:"remove",itemIndex:c,data:e.data}});document.dispatchEvent(v);let _=new CustomEvent("digicommerce_removed_from_cart",{detail:{source:"checkout_page",itemIndex:c,data:e.data}});if(document.dispatchEvent(_),digicommerceVars.proVersion&&digicommerceVars.enableSideCart){let t=new CustomEvent("digicommerce_cart_updated");document.dispatchEvent(t)}}else console.error("Remove cart item failed:",e),alert(e.data?.message||"Failed to remove item.")}catch(a){console.error("Cart removal error:",a),alert("An error occurred. Please try again.")}})})});})();
