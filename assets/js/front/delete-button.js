(()=>{document.addEventListener("DOMContentLoaded",function(){document.addEventListener("digicommerce_cart_updated",function(t){t.detail&&t.detail.source!=="checkout_page"&&setTimeout(()=>{window.location.reload()},200)});function r(){let t=document.getElementById("payment_method_paypal");return t&&t.checked}let c=document.querySelectorAll(".remove-item-btn");c&&c.forEach(t=>{t.addEventListener("click",async function(i){i.preventDefault();let a=this.dataset.index;try{let o=await(await fetch(digicommerceVars.ajaxurl,{method:"POST",body:new URLSearchParams({action:"digicommerce_remove_cart_item",index:a,nonce:digicommerceVars.order_nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if(o.success&&o.data){if(r()){window.location.href=window.location.pathname;return}if(this.closest(".cart-item").remove(),document.querySelectorAll(".remove-item-btn").forEach((e,s)=>{e.dataset.index=s}),document.querySelectorAll(".cart-item").length){let e=document.getElementById("cart-subtotal");e&&(e.innerHTML=o.data.formatted_prices.subtotal),window.vatCalculator&&window.vatCalculator.updateFromSubtotal()}else{let e=document.querySelector(".digicommerce-checkout");e&&digicommerceVars.empty_cart_template&&(e.innerHTML=digicommerceVars.empty_cart_template)}let d=new CustomEvent("digicommerce_cart_updated",{detail:{source:"checkout_page",action:"remove",itemIndex:a,data:o.data}});document.dispatchEvent(d);let m=new CustomEvent("digicommerce_removed_from_cart",{detail:{source:"checkout_page",itemIndex:a,data:o.data}});if(document.dispatchEvent(m),digicommerceVars.proVersion&&digicommerceVars.enableSideCart){let e=new CustomEvent("digicommerce_cart_updated");document.dispatchEvent(e)}}else console.error("Remove cart item failed:",o),alert(o.data?.message||"Failed to remove item.")}catch(n){console.error("Cart removal error:",n),alert("An error occurred. Please try again.")}})})});})();
