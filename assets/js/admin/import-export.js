(()=>{(function(){"use strict";document.addEventListener("DOMContentLoaded",function(){b()});function b(){let l=document.getElementById("digicommerce-export-form"),e=document.getElementById("digicommerce-import-form");!l&&!e||(y(),l&&x(l),e&&L(e))}function x(l){let e=document.getElementById("export-all"),r=document.querySelectorAll('#digicommerce-export-form input[type="checkbox"]:not(#export-all)'),s=Array.from(r);e&&e.addEventListener("change",function(){let a=this.checked;s.forEach(function(t){t.checked=a,t.disabled=a})}),s.forEach(function(a){a.addEventListener("change",function(){if(e){let t=s.every(function(n){return n.checked});e.checked=t}})}),l.addEventListener("submit",function(a){return document.querySelectorAll('#digicommerce-export-form input[type="checkbox"]:checked').length>0?!0:(a.preventDefault(),v(digiCommerceImportExport.selectOneOption||"Please select at least one option to export."),!1)})}function L(l){let e=document.getElementById("import-file"),r=document.getElementById("dropzone-area"),s=document.getElementById("file-preview"),a=s.querySelector(".file-name"),t=s.querySelector(".file-size"),n=s.querySelector(".file-remove");function u(i){if(i===0)return"0 Bytes";let o=1024,m=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(i)/Math.log(o));return parseFloat((i/Math.pow(o,c)).toFixed(1))+" "+m[c]}function f(i){a.textContent=i.name,t.textContent=u(i.size),s.classList.add("active")}if(e&&e.addEventListener("change",function(){this.files&&this.files[0]&&f(this.files[0])}),r){let i=function(d){d.preventDefault(),d.stopPropagation()},o=function(){r.classList.add("dragover")},m=function(){r.classList.remove("dragover")},c=function(d){let p=d.dataTransfer.files;p&&p.length&&(e.files=p,f(p[0]))};["dragenter","dragover","dragleave","drop"].forEach(d=>{r.addEventListener(d,i,!1)}),["dragenter","dragover"].forEach(d=>{r.addEventListener(d,o,!1)}),["dragleave","drop"].forEach(d=>{r.addEventListener(d,m,!1)}),r.addEventListener("drop",c,!1),r.addEventListener("click",function(d){d.target.closest("label")||d.target.closest("input")||e.click()})}n&&n.addEventListener("click",function(){e.value="",s.classList.remove("active")}),l.addEventListener("submit",function(i){return!e||!e.files||e.files.length===0?(i.preventDefault(),v(digiCommerceImportExport.selectFile||"Please select a file to import."),!1):e.files[0].name.split(".").pop().toLowerCase()!=="json"?(i.preventDefault(),v(digiCommerceImportExport.jsonFileOnly||"Please select a JSON file."),!1):digiCommerceImportExport.confirmImport?(i.preventDefault(),h(digiCommerceImportExport.confirmImport,function(){l.submit()}),!1):!0})}function y(){if(!document.getElementById("digi-import-export-modals-container")){let l=document.createElement("div");l.id="digi-import-export-modals-container",document.body.appendChild(l)}}let g=!1;function v(l,e=null){if(g)return;g=!0;let r="digi-import-export-alert-modal-"+Date.now(),s=`
            <div id="${r}" class="digi-modal">
                <div class="digi-modal-content" tabindex="-1">
                    <div class="digi-modal-header">
                        <span class="digi-modal-title">${digiCommerceImportExport.notice||"Notice"}</span>
                        <button type="button" class="digi-modal-close">&times;</button>
                    </div>
                    <div class="digi-modal-body">
                        <p>${l}</p>
                    </div>
                    <div class="digi-modal-footer">
                        <button type="button" class="digi-btn digi-btn-primary digi-modal-ok">${digiCommerceImportExport.ok||"OK"}</button>
                    </div>
                </div>
            </div>
        `;document.getElementById("digi-import-export-modals-container").insertAdjacentHTML("beforeend",s);let t=document.getElementById(r),n=t.querySelector(".digi-modal-content"),u=t.querySelector(".digi-modal-close"),f=t.querySelector(".digi-modal-ok");setTimeout(()=>{n.focus()},100);let i=()=>{t&&(t.classList.add("closing"),setTimeout(()=>{t.parentNode&&t.remove(),g=!1,typeof e=="function"&&e()},300))};u.addEventListener("click",i),f.addEventListener("click",i),t.addEventListener("click",o=>{o.target===t&&i()}),t.addEventListener("keydown",o=>{o.key==="Escape"&&(o.preventDefault(),i()),o.key==="Enter"&&(o.preventDefault(),i()),o.key==="Tab"&&(o.shiftKey&&document.activeElement===u?(o.preventDefault(),f.focus()):!o.shiftKey&&document.activeElement===f&&(o.preventDefault(),u.focus()))}),setTimeout(()=>{t.classList.add("active"),f.focus()},10)}function h(l,e,r=null){if(g)return;g=!0;let s="digi-import-export-confirm-modal-"+Date.now(),a=`
            <div id="${s}" class="digi-modal">
                <div class="digi-modal-content" tabindex="-1">
                    <div class="digi-modal-header">
                        <span class="digi-modal-title">${digiCommerceImportExport.confirmTitle||"Confirm"}</span>
                        <button type="button" class="digi-modal-close">&times;</button>
                    </div>
                    <div class="digi-modal-body">
                        <p>${l}</p>
                    </div>
                    <div class="digi-modal-footer">
                        <button type="button" class="digi-btn digi-btn-secondary digi-modal-cancel">${digiCommerceImportExport.cancel||"Cancel"}</button>
                        <button type="button" class="digi-btn digi-btn-primary digi-modal-confirm">${digiCommerceImportExport.confirm||"Confirm"}</button>
                    </div>
                </div>
            </div>
        `,t=document.getElementById("digi-import-export-modals-container");if(!t)return console.error("Modal container not found, creating it now"),y(),h(l,e,r);t.insertAdjacentHTML("beforeend",a);let n=document.getElementById(s),u=n.querySelector(".digi-modal-content"),f=n.querySelector(".digi-modal-close"),i=n.querySelector(".digi-modal-cancel"),o=n.querySelector(".digi-modal-confirm");setTimeout(()=>{u.focus()},100);let m=(c=!1)=>{n&&(n.classList.add("closing"),setTimeout(()=>{n.parentNode&&n.remove(),g=!1,c&&typeof e=="function"?e():!c&&typeof r=="function"&&r()},300))};f.addEventListener("click",()=>m(!1)),i.addEventListener("click",()=>m(!1)),o.addEventListener("click",()=>m(!0)),n.addEventListener("click",c=>{c.target===n&&m(!1)}),n.addEventListener("keydown",c=>{if(c.key==="Escape"&&(c.preventDefault(),m(!1)),c.key==="Enter"&&(c.preventDefault(),m(!0)),c.key==="Tab"){let d=[f,i,o],E=d[0],p=d[d.length-1];c.shiftKey&&document.activeElement===E?(c.preventDefault(),p.focus()):!c.shiftKey&&document.activeElement===p&&(c.preventDefault(),E.focus())}}),setTimeout(()=>{n.classList.add("active"),o.focus()},10)}})();})();
