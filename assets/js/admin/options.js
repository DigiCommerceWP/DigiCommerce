(()=>{document.addEventListener("DOMContentLoaded",function(){let m=document.querySelectorAll(".digicommerce-tab"),S=document.querySelectorAll(".digicommerce-tab-content"),v=document.querySelector('input[name="active_tab"]');function u(e){let t=new URL(window.location);t.searchParams.set("tab",e),window.history.pushState({},"",t),m.forEach(a=>a.classList.remove("active")),S.forEach(a=>a.classList.remove("active"));let o=document.querySelector(`[data-tab="${e}"]`);o&&o.classList.add("active");let r=document.querySelector(`#${e}`);r&&r.classList.add("active"),v&&(v.value=e)}m.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();let o=e.getAttribute("data-tab");u(o)})});let q=document.querySelectorAll('input[name="stripe_mode"]'),f=document.querySelector(".test-mode-keys"),p=document.querySelector(".live-mode-keys");q.forEach(e=>{e.addEventListener("change",function(){this.value==="test"?(f.style.display="flex",p.style.display="none"):(f.style.display="none",p.style.display="flex")})}),window.addEventListener("popstate",function(e){let o=new URLSearchParams(window.location.search).get("tab")||"general";u(o)});let A=new URLSearchParams(window.location.search).get("tab")||"general";u(A),document.querySelectorAll(".digicommerce__search").forEach(e=>{let t=new Choices(e,{searchEnabled:!0,searchPlaceholderValue:e.dataset.placeholder,searchResultLimit:-1})});let i;document.querySelectorAll(".upload-logo").forEach(e=>{let t=e.closest(".image-wrap"),o=t.querySelector('input[type="hidden"]'),r=t.querySelector('[class*="image-preview"]');e&&e.addEventListener("click",function(a){if(a.preventDefault(),i){i.open();return}i=wp.media({title:digiCommerceAdmin.mediaUploader.title,button:{text:digiCommerceAdmin.mediaUploader.buttonText},multiple:!1}),i.on("select",function(){let l=i.state().get("selection").first().toJSON();if(o&&(o.value=l.id),r){let n=document.createElement("img");n.src=l.url,n.className="max-w-64",n.onload=function(){r.classList.remove("hidden"),r.classList.add("flex"),r.innerHTML="",r.appendChild(n)},n.onerror=function(){console.error("Error loading image preview")}}if(!e.parentElement.querySelector(".remove-logo")){let n=document.createElement("button");n.type="button",n.className="remove-logo flex items-center justify-center gap-2 bg-red-600 hover:bg-red-400 text-white hover:text-white py-2 px-4 rounded default-transition",n.innerHTML=`<span class="text">${digiCommerceAdmin.mediaUploader.removeText}</span>`,e.insertAdjacentElement("afterend",n),n.addEventListener("click",function(){o&&(o.value=""),r&&(r.innerHTML="",r.classList.add("hidden"),r.classList.remove("flex")),n.remove()})}}),i.open()})}),document.querySelectorAll(".remove-logo").forEach(e=>{e.addEventListener("click",function(){let t=e.closest(".image-wrap"),o=t.querySelector('input[type="hidden"]'),r=t.querySelector('[class*="image-preview"]');o&&(o.value=""),r&&(r.innerHTML="",r.classList.add("hidden"),r.classList.remove("flex")),e.remove()})});let c=document.querySelector(".social-links-container"),_=document.querySelector(".add-social-link"),g=window.digicommerce?.socialLinks||[];g.length>0&&g.forEach(e=>h(e));function $(e={platform:"",url:""}){let t=document.createElement("div");t.className="social-link-row flex flex-col mdl:flex-row mdl:items-center gap-4 border rounded p-2.5 border-solid border-[#ddd] cursor-move",t.draggable=!0;let o=[{value:"facebook",label:"Facebook"},{value:"twitter",label:"X"},{value:"instagram",label:"Instagram"},{value:"linkedin",label:"LinkedIn"},{value:"youtube",label:"YouTube"},{value:"pinterest",label:"Pinterest"},{value:"tiktok",label:"TikTok"}],r=document.querySelectorAll(".social-link-row").length;return t.innerHTML=`
            <div class="flex gap-2 w-full">
                <div class="drag-handle flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="7" r="1"/>
                        <circle cx="12" cy="12" r="1"/>
                        <circle cx="12" cy="17" r="1"/>
                        <circle cx="7" cy="7" r="1"/>
                        <circle cx="7" cy="12" r="1"/>
                        <circle cx="7" cy="17" r="1"/>
                    </svg>
                </div>
                <select name="social_links[${r}][platform]" 
                        id="social_platform_${r}"
                        class="regular-text"
                        style="max-width:100%">
                    ${o.map(l=>`
                        <option value="${l.value}" 
                            ${e.platform===l.value?"selected":""}>
                            ${l.label}
                        </option>
                    `).join("")}
                </select>
            </div>
            <div class="flex flex-col gap-2 w-full">
                <input type="url" 
                        id="social_url_${r}" 
                        name="social_links[${r}][url]" 
                        value="${e.url}"
                        class="regular-text"
                        placeholder="https://${digiCommerceAdmin.socialMedia.placeholder}.com/">
            </div>
            <button type="button" class="remove-social-link flex items-center justify-center gap-2 bg-red-600 hover:bg-red-400 text-white hover:text-white py-2 px-4 rounded default-transition">
                ${digiCommerceAdmin.socialMedia.remove}
            </button>
        `,t.querySelector(".remove-social-link").addEventListener("click",()=>{t.remove(),d()}),t.addEventListener("dragstart",y),t.addEventListener("dragend",L),t.addEventListener("dragover",w),t.addEventListener("dragenter",b),t.addEventListener("dragleave",E),t.addEventListener("drop",k),t}function h(e={platform:"",url:""}){let t=$(e);c.appendChild(t),t.querySelector(".remove-social-link").addEventListener("click",()=>{t.remove(),d()})}function d(){document.querySelectorAll(".social-link-row").forEach((t,o)=>{let r=t.querySelector("select"),a=t.querySelector("input"),l=t.querySelector('label[for^="social_platform_"]'),x=t.querySelector('label[for^="social_url_"]');r.name=`social_links[${o}][platform]`,r.id=`social_platform_${o}`,a.name=`social_links[${o}][url]`,a.id=`social_url_${o}`,l.setAttribute("for",`social_platform_${o}`),x.setAttribute("for",`social_url_${o}`)})}let s=null;function y(e){s=this,this.style.opacity="0.4",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML)}function L(e){this.style.opacity="1",document.querySelectorAll(".social-link-row").forEach(o=>{o.classList.remove("drag-over")})}function w(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function b(e){this.classList.add("drag-over")}function E(e){this.classList.remove("drag-over")}function k(e){if(e.stopPropagation&&e.stopPropagation(),s!==this){let t=Array.from(c.children).indexOf(this),o=Array.from(c.children).indexOf(s);t>o?c.insertBefore(s,this.nextSibling):c.insertBefore(s,this)}return this.classList.remove("drag-over"),d(),!1}_.addEventListener("click",()=>h()),document.querySelectorAll(".social-link-row .remove-social-link").forEach(e=>{e.addEventListener("click",()=>{e.closest(".social-link-row").remove(),d()})}),document.querySelectorAll(".social-link-row").forEach(e=>{e.addEventListener("dragstart",y),e.addEventListener("dragend",L),e.addEventListener("dragover",w),e.addEventListener("dragenter",b),e.addEventListener("dragleave",E),e.addEventListener("drop",k)}),document.querySelectorAll('input[type="color"]').forEach(e=>{let t=e.id,o=digiCommerceAdmin.colors[t].default;e.value||(e.value=o)})});})();
